<!DOCTYPE html>
<html lang="lb">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>P4 – De Kalenner</title>
  <style>
    /* Font */
    @font-face{
      font-family:'Schoulschrëft';
      src:url('https://raw.githubusercontent.com/albrechtclaire1007/schoulschreft/main/schoulschreft_bold%5B2%5D.TTF') format('truetype');
      font-weight:bold;
      font-style:normal;
      font-display:swap;
    }

    :root{
      --purple-mid:#b7a2e5;
      --purple-light:#ebe3ff;
      --purple-dark:#6c4aa3;
      --ink:#2d1844;
      --white:#fff;
      --ok:#b7f0c8;
      --bad:#ffcccc;
      --border:3px;
      --radius:18px;
    }

    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family:'Schoulschrëft', system-ui, sans-serif;
      background:var(--purple-light);
      color:var(--ink);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:8px;
    }
    button{
      font-family:'Schoulschrëft', system-ui, sans-serif;
    }

    .app{
      background:var(--white);
      border-radius:24px;
      border:var(--border) solid var(--purple-dark);
      max-width:1100px;
      width:100%;
      padding:12px 12px 16px;
      box-shadow:0 10px 25px rgba(0,0,0,0.12);
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    /* Top bar with arrows */
    .top-bar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      background:var(--purple-mid);
      border-radius:999px;
      padding:4px 10px;
      color:var(--white);
    }
    .top-bar-title{
      font-size:1.1rem;
      text-align:center;
      flex:1;
    }
    .top-arrow{
      width:28px;
      height:28px;
      border-radius:50%;
      border:2px solid var(--white);
      background:transparent;
      color:var(--white);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-size:1.1rem;
    }
    .top-arrow:disabled{
      opacity:0.4;
      cursor:default;
    }

    .subtitle{
      text-align:center;
      font-size:0.9rem;
      opacity:0.8;
      margin-top:2px;
    }

    /* Nav pills underneath */
    .nav{
      display:flex;
      flex-wrap:wrap;
      gap:4px;
      justify-content:center;
      margin-top:4px;
    }
    .nav button{
      flex:1 1 120px;
      padding:4px 8px;
      border-radius:999px;
      border:2px solid var(--purple-mid);
      background:var(--purple-light);
      color:var(--ink);
      font-size:0.9rem;
      cursor:pointer;
      transition:.15s;
      white-space:nowrap;
    }
    .nav button.active{
      background:var(--purple-mid);
      color:var(--white);
      border-color:var(--purple-dark);
      transform:translateY(-1px);
    }

    .games{
      position:relative;
      min-height:320px;
      margin-top:6px;
    }
    .game{
      display:none;
      animation:fadeIn .25s ease-out;
    }
    .game.active{display:block;}

    @keyframes fadeIn{
      from{opacity:0;transform:translateY(4px);}
      to{opacity:1;transform:translateY(0);}
    }

    .game-inner{
      border-radius:var(--radius);
      border:2px solid var(--purple-mid);
      padding:10px;
      background:#faf8ff;
    }

    .game h2{
      font-size:1.15rem;
      margin-bottom:4px;
      color:var(--purple-dark);
    }
    .instructions{
      font-size:0.9rem;
      margin-bottom:8px;
    }

    button.primary{
      padding:6px 14px;
      border-radius:999px;
      border:2px solid var(--purple-dark);
      background:var(--purple-mid);
      color:var(--white);
      font-size:0.9rem;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
      margin-bottom:6px;
    }
    button.secondary{
      padding:4px 10px;
      border-radius:999px;
      border:2px solid var(--purple-mid);
      background:var(--white);
      color:var(--ink);
      font-size:0.85rem;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
      margin-top:2px;
    }
    button:disabled{
      opacity:0.5;
      cursor:default;
    }

    .feedback{
      margin-top:6px;
      min-height:1.4em;
      font-size:0.9rem;
    }
    .feedback.ok{color:#117a3a;}
    .feedback.bad{color:#b02323;}

    /* GAME 1 */
    .g1-layout{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    @media(min-width:780px){
      .g1-layout{
        flex-direction:row;
      }
    }
    .g1-left{
      flex:0 0 220px;
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:flex-start;
    }
    .audio-btn{
      width:56px;
      height:56px;
      border-radius:50%;
      border:3px solid var(--purple-dark);
      background:var(--purple-mid);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      box-shadow:0 3px 0 rgba(0,0,0,0.15);
      transition:.12s;
    }
    .audio-btn span{
      width:0;
      height:0;
      border-top:10px solid transparent;
      border-bottom:10px solid transparent;
      border-left:16px solid #fff;
      margin-left:2px;
    }
    .audio-label{
      font-size:0.9rem;
    }
    .g1-calendar-wrapper{
      position:relative;
      flex:1 1 auto;
      max-width:620px;
      margin:0 auto;
    }
    .g1-calendar-wrapper img{
      width:100%;
      display:block;
      border-radius:var(--radius);
      border:2px solid var(--purple-mid);
    }
    .g1-hotspots{
      position:absolute;
      inset:18% 5% 10% 5%; /* fine-tune if needed */
      display:grid;
      grid-template-columns:repeat(7,1fr);
      grid-template-rows:repeat(6,1fr);
    }
    .g1-cell{
      position:relative;
      cursor:pointer;
    }
    .g1-cell::after{
      content:attr(data-day);
      position:absolute;
      inset:4px;
      display:flex;
      align-items:flex-start;
      justify-content:flex-end;
      font-size:0.6rem;
      opacity:0; /* set to .5 for debug */
      pointer-events:none;
    }
    .g1-cell.correct{
      background:rgba(183,240,200,0.35);
      border-radius:8px;
    }
    .g1-cell.wrong{
      background:rgba(255,204,204,0.35);
      border-radius:8px;
      animation:shake .16s linear;
    }
    @keyframes shake{
      0%{transform:translateX(0);}
      25%{transform:translateX(-3px);}
      50%{transform:translateX(3px);}
      75%{transform:translateX(-2px);}
      100%{transform:translateX(0);}
    }

    /* GAME 2 */
    .g2-question{
      font-size:1.0rem;
      margin-bottom:8px;
    }
    .g2-options{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(110px,1fr));
      gap:6px;
    }
    .g2-options button{
      padding:6px;
      border-radius:var(--radius);
      border:2px solid var(--purple-mid);
      background:var(--white);
      cursor:pointer;
      font-size:0.9rem;
    }
    .g2-options button.correct{
      background:var(--ok);
      border-color:#169451;
    }
    .g2-options button.wrong{
      background:var(--bad);
      border-color:#a52828;
    }

    /* GAME 3 – wheels */
    .g3-display{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
      margin-top:6px;
    }
    .wheels{
      display:flex;
      align-items:center;
      gap:3px;
      padding:10px 14px;
      border-radius:18px;
      background:var(--white);
      border:2px solid var(--purple-mid);
      font-size:1.4rem;
    }
    .wheel{
      width:26px;
      height:40px;
      border-radius:10px;
      border:2px solid var(--purple-mid);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      position:relative;
      background:#f9f5ff;
    }
    .wheel span{
      position:absolute;
      animation:none;
    }
    .dot{
      font-size:1.4rem;
      padding:0 3px;
    }
    @keyframes wheelSpin{
      0%{transform:translateY(-110%);}
      100%{transform:translateY(0);}
    }
    .g3-buttons{
      display:flex;
      gap:8px;
      margin-top:2px;
    }

    /* GAME 4 – matching */
    .g4-layout{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
      margin-top:4px;
    }
    @media(max-width:800px){
      .g4-layout{
        grid-template-columns:1fr;
      }
    }
    .g4-box{
      border-radius:var(--radius);
      border:2px solid var(--purple-dark);
      background:rgba(183,162,229,0.1);
      padding:6px;
    }
    .g4-box h3{
      font-size:0.95rem;
      margin-bottom:4px;
      color:var(--purple-dark);
      text-align:center;
    }
    .g4-list{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .g4-item{
      padding:5px 7px;
      border-radius:var(--radius);
      border:2px solid var(--purple-mid);
      background:#fff;
      font-size:0.9rem;
      cursor:pointer;
      position:relative;
    }
    .g4-item.selected{
      border-color:var(--purple-dark);
      box-shadow:0 0 0 2px rgba(108,74,163,0.2);
    }
    .g4-slot{
      margin-top:2px;
      font-size:0.75rem;
      opacity:0.8;
    }
    .g4-cards{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:2px;
      justify-content:center;
    }
    .g4-card{
      padding:5px 9px;
      border-radius:999px;
      border:2px solid var(--purple-mid);
      background:#fff;
      cursor:pointer;
      font-size:0.9rem;
    }
    .g4-card.used{
      opacity:0.4;
      cursor:default;
    }

    /* GAME 5 – write date */
    .g5-prompt{
      font-size:1.0rem;
      margin-bottom:6px;
    }
    .g5-input-row{
      display:flex;
      flex-direction:column;
      gap:4px;
      margin-bottom:4px;
    }
    .g5-input-row input{
      width:100%;
      padding:6px 8px;
      border-radius:var(--radius);
      border:2px solid var(--purple-mid);
      font-size:0.95rem;
      font-family:'Schoulschrëft', system-ui, sans-serif;
    }
    .g5-keyboard{
      display:flex;
      flex-direction:column;
      gap:3px;
      margin:4px 0 6px;
    }
    .g5-row{
      display:flex;
      flex-wrap:wrap;
      gap:3px;
      justify-content:center;
    }
    .g5-key{
      min-width:26px;
      padding:4px 6px;
      border-radius:8px;
      border:1px solid var(--purple-mid);
      background:#fff;
      font-size:0.8rem;
      cursor:pointer;
    }
    .g5-key.wide{
      min-width:50px;
    }
    .g5-key.shift-active{
      background:var(--purple-mid);
      color:var(--white);
    }
    .solution{
      margin-top:2px;
      font-size:0.8rem;
      opacity:0.85;
    }
    .progress{
      margin-top:2px;
      font-size:0.8rem;
      opacity:0.8;
    }
  </style>
</head>
<body>
<div class="app">
  <!-- Top bar -->
  <div class="top-bar">
    <button id="topPrev" class="top-arrow">‹</button>
    <div id="topTitle" class="top-bar-title">1. Lauschter & klick</div>
    <button id="topNext" class="top-arrow">›</button>
  </div>
  <p class="subtitle">P4 – De Kalenner: Datumer liesen a schreiwen</p>

  <!-- nav pills -->
  <div class="nav">
    <button class="nav-btn active" data-index="0" data-target="game1">1. Lauschter & klick</button>
    <button class="nav-btn" data-index="1" data-target="game2">2. Lies & klick</button>
    <button class="nav-btn" data-index="2" data-target="game3">3. Lies den Datum</button>
    <button class="nav-btn" data-index="3" data-target="game4">4. Fann de passenden Datum</button>
    <button class="nav-btn" data-index="4" data-target="game5">5. Schreif den Datum</button>
  </div>

  <div class="games">
    <!-- GAME 1 -->
    <section id="game1" class="game active">
      <div class="game-inner">
        <h2>1. Lauschter & klick op den Datum</h2>
        <div class="g1-layout">
          <div class="g1-left">
            <button id="g1PlayBtn" class="audio-btn" title="Lauschteren">
              <span></span>
            </button>
            <p class="audio-label">Klick op de Knäppchen fir ze lauschteren an duerno op den Datum.</p>
            <button id="g1NextBtn" class="secondary">Nächsten Datum</button>
            <div id="g1Feedback" class="feedback"></div>
          </div>
          <div class="g1-calendar-wrapper">
            <img id="g1CalendarImg"
                 src="https://i.postimg.cc/fyq9S0fD/Beige-and-Brown-Illustrated-Cute-Autumn-November-2023-Monthly-Calendar.png"
                 alt="November 2023 Kalenner">
            <div class="g1-hotspots" id="g1Hotspots"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- GAME 2 -->
    <section id="game2" class="game">
      <div class="game-inner">
        <h2>2. Lies den Datum & klick op déi richteg Zueleschreifweis</h2>
        <div id="g2Question" class="g2-question"></div>
        <div id="g2Options" class="g2-options"></div>
        <button id="g2NextBtn" class="secondary" style="margin-top:6px;">Nächst Fro</button>
        <div id="g2Feedback" class="feedback"></div>
      </div>
    </section>

    <!-- GAME 3 -->
    <section id="game3" class="game">
      <div class="game-inner">
        <h2>3. Lies den Datum</h2>
        <div class="g3-display">
          <div class="wheels" id="g3Wheels">
            <div class="wheel" data-pos="0"><span>0</span></div>
            <div class="wheel" data-pos="1"><span>1</span></div>
            <div class="dot">.</div>
            <div class="wheel" data-pos="2"><span>0</span></div>
            <div class="wheel" data-pos="3"><span>1</span></div>
            <div class="dot">.</div>
            <div class="wheel" data-pos="4"><span>2</span></div>
            <div class="wheel" data-pos="5"><span>0</span></div>
            <div class="wheel" data-pos="6"><span>2</span></div>
            <div class="wheel" data-pos="7"><span>4</span></div>
          </div>
          <div class="g3-buttons">
            <button id="g3PrevBtn" class="secondary">◀️ Zréck</button>
            <button id="g3NextBtn" class="primary">▶️ Nächsten Datum</button>
          </div>
        </div>
      </div>
    </section>

    <!-- GAME 4 -->
    <section id="game4" class="game">
      <div class="game-inner">
        <h2>4. Fann de passenden Datum</h2>
        <p class="instructions">Wielt e Saz a klick duerno op déi passend Zueleschreifweis.</p>
        <div class="g4-layout">
          <div class="g4-box">
            <h3>Datumer am Saz</h3>
            <div id="g4List" class="g4-list"></div>
          </div>
          <div class="g4-box">
            <h3>Zueleschreifweis</h3>
            <div id="g4Cards" class="g4-cards"></div>
          </div>
        </div>
        <button id="g4ResetBtn" class="secondary" style="margin-top:6px;">Nach eng Kéier</button>
        <div id="g4Feedback" class="feedback"></div>
      </div>
    </section>

    <!-- GAME 5 -->
    <section id="game5" class="game">
      <div class="game-inner">
        <h2>5. Schreif den Datum</h2>
        <div id="g5Prompt" class="g5-prompt"></div>
        <div class="g5-input-row">
          <input id="g5Input" type="text" autocomplete="off"
                 placeholder="Den dräizéngte Mäerz ..." />
        </div>
        <div class="g5-keyboard" id="g5Keyboard"></div>
        <button id="g5CheckBtn" class="primary">Kontrolléier</button>
        <button id="g5NextBtn" class="secondary">Nächst</button>
        <div id="g5Feedback" class="feedback"></div>
        <div id="g5Solution" class="solution"></div>
        <div id="g5Progress" class="progress"></div>
      </div>
    </section>
  </div>
</div>

<script>
  /* ------------ NAV & TOP BAR ------------ */
  const navButtons = document.querySelectorAll('.nav-btn');
  const games = document.querySelectorAll('.game');
  const topTitle = document.getElementById('topTitle');
  const topPrev = document.getElementById('topPrev');
  const topNext = document.getElementById('topNext');

  const gameTitles = [
    '1. Lauschter & klick',
    '2. Lies & klick',
    '3. Lies den Datum',
    '4. Fann de passenden Datum',
    '5. Schreif den Datum'
  ];

  let currentGameIndex = 0;

  function setGame(index){
    currentGameIndex = index;
    games.forEach(g=>g.classList.remove('active'));
    games[index].classList.add('active');

    navButtons.forEach(b=>b.classList.remove('active'));
    navButtons[index].classList.add('active');

    topTitle.textContent = gameTitles[index];
    topPrev.disabled = (index===0);
    topNext.disabled = (index===games.length-1);
  }

  navButtons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const idx = Number(btn.dataset.index);
      setGame(idx);
    });
  });

  topPrev.addEventListener('click', ()=>{
    if(currentGameIndex>0) setGame(currentGameIndex-1);
  });
  topNext.addEventListener('click', ()=>{
    if(currentGameIndex<games.length-1) setGame(currentGameIndex+1);
  });

  /* ------------ GAME 1: Lauschter & Klick ------------ */
  const AUDIO_BASE_URL =
    "https://github.com/albrechtclaire1007/p4kalenner/raw/refs/heads/main/";

  const g1Audio = new Audio();
  const g1PlayBtn = document.getElementById('g1PlayBtn');
  const g1NextBtn = document.getElementById('g1NextBtn');
  const g1Feedback = document.getElementById('g1Feedback');
  const g1Hotspots = document.getElementById('g1Hotspots');

  const rows = 6;
  const cols = 7;

  // build grid
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const cell = document.createElement('div');
      cell.className = 'g1-cell';
      cell.dataset.row = r;
      cell.dataset.col = c;
      g1Hotspots.appendChild(cell);
    }
  }
  const g1Cells = Array.from(document.querySelectorAll('.g1-cell'));

  // November 2023 layout: first row = 29,30,31,1,2,3,4
  const totalDays = 30;
  const startOffset = 3; // index of "1" in first row
  for(let day=1; day<=totalDays; day++){
    const index = (day-1)+startOffset;
    const r = Math.floor(index/cols);
    const c = index%cols;
    const cell = g1Cells.find(el => +el.dataset.row===r && +el.dataset.col===c);
    if(cell){
      cell.dataset.day = day;
    }
  }

  let g1CurrentDay = null;
  let g1Locked = false;

  function g1SetTask(){
    g1Locked = false;
    g1Feedback.textContent = 'Lauschter an da klick op den Datum.';
    g1Feedback.className = 'feedback';
    g1Cells.forEach(c=>{c.classList.remove('correct','wrong');});
    g1CurrentDay = Math.floor(Math.random()*totalDays)+1;
    const filename = `P4__${g1CurrentDay}..mp3`;
    g1Audio.src = AUDIO_BASE_URL + filename;
  }

  g1PlayBtn.addEventListener('click', ()=>{
    if(!g1Audio.src) g1SetTask();
    g1Audio.currentTime = 0;
    g1Audio.play();
  });

  g1NextBtn.addEventListener('click', g1SetTask);

  g1Cells.forEach(cell=>{
    cell.addEventListener('click', ()=>{
      if(g1Locked || !cell.dataset.day) return;
      const chosen = Number(cell.dataset.day);
      if(chosen === g1CurrentDay){
        cell.classList.add('correct');
        g1Feedback.textContent = `Super! Dat war den ${g1CurrentDay}.`;
        g1Feedback.className = 'feedback ok';
        g1Locked = true;
      }else{
        cell.classList.add('wrong');
        setTimeout(()=>cell.classList.remove('wrong'),200);
        g1Feedback.textContent = 'Nee, probéier nach eng Kéier.';
        g1Feedback.className = 'feedback bad';
      }
    });
  });

  g1SetTask();

  /* ------------ GAME 2: Read & MCQ ------------ */
  const g2QuestionEl = document.getElementById('g2Question');
  const g2OptionsEl = document.getElementById('g2Options');
  const g2Feedback = document.getElementById('g2Feedback');
  const g2NextBtn = document.getElementById('g2NextBtn');

  const g2Tasks = [
    {text:"Den éischten Januar", correct:"01.01.",
      others:["10.01.","01.10.","11.01.","31.01."]},
    {text:"Den zweeten Januar", correct:"02.01.",
      others:["20.01.","02.10.","12.01.","21.01."]},
    {text:"Den drëtten Februar", correct:"03.02.",
      others:["02.03.","30.02.","13.02.","03.12."]},
    {text:"De véierte Mäerz", correct:"04.03.",
      others:["03.04.","14.03.","04.05.","24.03."]},
    {text:"De fënneften Abrëll", correct:"05.04.",
      others:["04.05.","15.04.","05.06.","25.04."]},
    {text:"De sechsten Mee", correct:"06.05.",
      others:["05.06.","16.05.","06.03.","26.05."]},
    {text:"De siwenten Juni", correct:"07.06.",
      others:["06.07.","17.06.","07.09.","27.06."]},
    {text:"Den aachten Juli", correct:"08.07.",
      others:["07.08.","18.07.","08.06.","28.07."]},
    {text:"Den néngten August", correct:"09.08.",
      others:["19.08.","09.10.","29.08.","09.03."]},
    {text:"Den zéngten September", correct:"10.09.",
      others:["09.10.","01.09.","20.09.","10.11."]},
    {text:"Den eelefsten Oktober", correct:"11.10.",
      others:["10.11.","21.10.","12.10.","11.01."]},
    {text:"Den zwielefsten Oktober", correct:"12.10.",
      others:["21.12.","10.12.","02.10.","13.10."]},
    {text:"Den dräizéngten November", correct:"13.11.",
      others:["31.11.","13.01.","23.11.","03.11."]},
    {text:"De véierzéngten November", correct:"14.11.",
      others:["24.11.","14.01.","04.11.","10.04."]},
    {text:"De fofzéngten November", correct:"15.11.",
      others:["05.11.","25.11.","15.01.","11.05."]},
    {text:"De siechzéngten Dezember", correct:"16.12.",
      others:["06.12.","26.12.","10.12.","16.10."]},
    {text:"De siwwenzéngten Dezember", correct:"17.12.",
      others:["07.12.","27.12.","17.11.","10.07."]},
    {text:"Den uechtzéngten Dezember", correct:"18.12.",
      others:["08.12.","28.12.","18.10.","18.02."]},
    {text:"Den nonzéngten Dezember", correct:"19.12.",
      others:["09.12.","29.12.","10.09.","19.10."]},
    {text:"Den eenanzwanzegsten Mee", correct:"21.05.",
      others:["12.05.","20.05.","21.03.","21.06."]}
  ];

  function shuffle(array){
    return array
      .map(v=>({v, sort:Math.random()}))
      .sort((a,b)=>a.sort-b.sort)
      .map(({v})=>v);
  }

  let g2Index = 0;

  function g2RenderTask(){
    g2Feedback.textContent = '';
    g2Feedback.className = 'feedback';
    g2OptionsEl.innerHTML = '';
    const task = g2Tasks[g2Index];
    g2QuestionEl.textContent = task.text;

    const options = shuffle([task.correct, ...task.others]);
    options.forEach(opt=>{
      const btn = document.createElement('button');
      btn.textContent = opt;
      btn.addEventListener('click', ()=>{
        const isCorrect = opt === task.correct;
        Array.from(g2OptionsEl.children).forEach(b=>b.disabled=true);
        if(isCorrect){
          btn.classList.add('correct');
          g2Feedback.textContent = "Super, dat ass richteg!";
          g2Feedback.className = 'feedback ok';
        }else{
          btn.classList.add('wrong');
          g2Feedback.textContent = `Nee, richteg wier: ${task.correct}`;
          g2Feedback.className = 'feedback bad';
          Array.from(g2OptionsEl.children).forEach(b=>{
            if(b.textContent===task.correct){
              b.classList.add('correct');
            }
          });
        }
      });
      g2OptionsEl.appendChild(btn);
    });
  }

  g2NextBtn.addEventListener('click', ()=>{
    g2Index = (g2Index+1) % g2Tasks.length;
    g2RenderTask();
  });

  g2RenderTask();

  /* ------------ GAME 3: Spinning date wheels ------------ */
  const g3Wheels = document.querySelectorAll('.wheel');
  const g3PrevBtn = document.getElementById('g3PrevBtn');
  const g3NextBtn = document.getElementById('g3NextBtn');

  const g3History = [];
  let g3Pointer = -1;

  function daysInMonth(month, year){
    return new Date(year, month, 0).getDate();
  }

  function pad(num, len){
    return num.toString().padStart(len,'0');
  }

  function generateRandomDate(){
    const year = 2000 + Math.floor(Math.random()*100); // 2000–2099
    const month = 1 + Math.floor(Math.random()*12);
    const dim = daysInMonth(month, year);
    const day = 1 + Math.floor(Math.random()*dim);
    return {day, month, year};
  }

  function dateToDigits(d){
    const dd = pad(d.day,2);
    const mm = pad(d.month,2);
    const yyyy = pad(d.year,4);
    return (dd + mm + yyyy).split('');
  }

  function g3AnimateWheel(wheel, newDigit){
    const span = wheel.querySelector('span');
    // reset animation
    span.style.animation = 'none';
    span.offsetHeight; // force reflow
    span.textContent = newDigit;
    span.style.animation = 'wheelSpin .25s ease-out';
  }

  function g3ShowDate(d, pushToHistory=true){
    const digits = dateToDigits(d);
    g3Wheels.forEach((wheel,i)=>{
      g3AnimateWheel(wheel, digits[i]);
    });
    if(pushToHistory){
      g3History.splice(g3Pointer+1);
      g3History.push(d);
      g3Pointer = g3History.length-1;
    }
    g3PrevBtn.disabled = g3Pointer<=0;
  }

  g3NextBtn.addEventListener('click', ()=>{
    const d = generateRandomDate();
    g3ShowDate(d,true);
  });

  g3PrevBtn.addEventListener('click', ()=>{
    if(g3Pointer>0){
      g3Pointer--;
      const d = g3History[g3Pointer];
      g3ShowDate(d,false);
    }
  });

  g3ShowDate(generateRandomDate(), true);

  /* ------------ GAME 4: Matching ------------ */
  const g4ListEl = document.getElementById('g4List');
  const g4CardsEl = document.getElementById('g4Cards');
  const g4Feedback = document.getElementById('g4Feedback');
  const g4ResetBtn = document.getElementById('g4ResetBtn');

  const g4Pairs = [
    {id:1, text:"Den éischten Januar", numeric:"01.01."},
    {id:2, text:"Den zweeten Januar", numeric:"02.01."},
    {id:3, text:"Den drëtten Februar", numeric:"03.02."},
    {id:4, text:"De véierte Mäerz", numeric:"04.03."},
    {id:5, text:"De fënneften Abrëll", numeric:"05.04."},
    {id:6, text:"De sechsten Mee", numeric:"06.05."},
    {id:7, text:"De siwenten Juni", numeric:"07.06."},
    {id:8, text:"Den aachten Juli", numeric:"08.07."},
    {id:9, text:"Den néngten August", numeric:"09.08."},
    {id:10, text:"Den zéngten September", numeric:"10.09."},
    {id:11, text:"Den eelefsten Oktober", numeric:"11.10."},
    {id:12, text:"Den zwielefsten Oktober", numeric:"12.10."},
    {id:13, text:"Den dräizéngten November", numeric:"13.11."},
    {id:14, text:"De véierzéngten November", numeric:"14.11."},
    {id:15, text:"De fofzéngten November", numeric:"15.11."},
    {id:16, text:"De siechzéngten Dezember", numeric:"16.12."},
    {id:17, text:"De siwwenzéngten Dezember", numeric:"17.12."},
    {id:18, text:"Den uechtzéngten Dezember", numeric:"18.12."},
    {id:19, text:"Den nonzéngten Dezember", numeric:"19.12."},
    {id:20, text:"Den eenanzwanzegsten Mee", numeric:"21.05."}
  ];

  let g4SelectedSentenceId = null;

  function g4Render(){
    g4Feedback.textContent='';
    g4ListEl.innerHTML='';
    g4CardsEl.innerHTML='';
    g4SelectedSentenceId = null;

    g4Pairs.forEach(pair=>{
      const item = document.createElement('div');
      item.className = 'g4-item';
      item.dataset.id = pair.id;
      item.innerHTML = `<div>${pair.text}</div><div class="g4-slot" data-slot-for="${pair.id}">...</div>`;
      item.addEventListener('click', ()=>{
        Array.from(g4ListEl.children).forEach(el=>el.classList.remove('selected'));
        item.classList.add('selected');
        g4SelectedSentenceId = pair.id;
      });
      g4ListEl.appendChild(item);
    });

    const shuffled = shuffle(g4Pairs.slice());
    shuffled.forEach(pair=>{
      const card = document.createElement('div');
      card.className = 'g4-card';
      card.dataset.id = pair.id;
      card.textContent = pair.numeric;
      card.addEventListener('click', ()=>{
        if(card.classList.contains('used')) return;
        if(!g4SelectedSentenceId){
          g4Feedback.textContent = "Wielt fir d'éischt e Saz.";
          g4Feedback.className = 'feedback bad';
          return;
        }
        const correctId = card.dataset.id;
        if(Number(correctId) === Number(g4SelectedSentenceId)){
          const slot = g4ListEl.querySelector(`[data-slot-for="${g4SelectedSentenceId}"]`);
          slot.textContent = card.textContent;
          card.classList.add('used');
          g4Feedback.textContent = "Super! Dat passt.";
          g4Feedback.className = 'feedback ok';
          Array.from(g4ListEl.children).forEach(el=>el.classList.remove('selected'));
          g4SelectedSentenceId = null;

          const allSlotsFilled = g4Pairs.every(p=>{
            const s = g4ListEl.querySelector(`[data-slot-for="${p.id}"]`);
            return s && s.textContent !== '...';
          });
          if(allSlotsFilled){
            g4Feedback.textContent = "Bravo! All Datumer si richteg gepaart.";
          }
        }else{
          g4Feedback.textContent = "Nee, deen Datum passt net zu deem Saz.";
          g4Feedback.className = 'feedback bad';
        }
      });
      g4CardsEl.appendChild(card);
    });
  }

  g4ResetBtn.addEventListener('click', g4Render);
  g4Render();

  /* ------------ GAME 5: Schreif den Datum ------------ */
  const g5Prompt = document.getElementById('g5Prompt');
  const g5Input = document.getElementById('g5Input');
  const g5Keyboard = document.getElementById('g5Keyboard');
  const g5CheckBtn = document.getElementById('g5CheckBtn');
  const g5NextBtn = document.getElementById('g5NextBtn');
  const g5Feedback = document.getElementById('g5Feedback');
  const g5Solution = document.getElementById('g5Solution');
  const g5Progress = document.getElementById('g5Progress');

  const g5Tasks = [
    {prompt:"01.01.", solution:"Den éischten Januar"},
    {prompt:"02.01.", solution:"Den zweeten Januar"},
    {prompt:"03.02.", solution:"Den drëtten Februar"},
    {prompt:"04.03.", solution:"De véierte Mäerz"},
    {prompt:"05.04.", solution:"De fënneften Abrëll"},
    {prompt:"06.05.", solution:"De sechsten Mee"},
    {prompt:"07.06.", solution:"De siwenten Juni"},
    {prompt:"08.07.", solution:"Den aachten Juli"},
    {prompt:"09.08.", solution:"Den néngten August"},
    {prompt:"10.09.", solution:"Den zéngten September"},
    {prompt:"11.10.", solution:"Den eelefsten Oktober"},
    {prompt:"12.10.", solution:"Den zwielefsten Oktober"},
    {prompt:"13.11.", solution:"Den dräizéngten November"},
    {prompt:"14.11.", solution:"De véierzéngten November"},
    {prompt:"15.11.", solution:"De fofzéngten November"},
    {prompt:"16.12.", solution:"De siechzéngten Dezember"},
    {prompt:"17.12.", solution:"De siwwenzéngten Dezember"},
    {prompt:"18.12.", solution:"Den uechtzéngten Dezember"},
    {prompt:"19.12.", solution:"Den nonzéngten Dezember"},
    {prompt:"21.05.", solution:"Den eenanzwanzegsten Mee"}
  ];
  let g5Index = 0;

  function normalize(str){
    return str
      .toLowerCase()
      .replace(/\s+/g,' ')
      .trim();
  }

  function g5RenderTask(){
    const task = g5Tasks[g5Index];
    g5Prompt.textContent = `Schreiw: ${task.prompt}`;
    g5Input.value = '';
    g5Input.focus();
    g5Feedback.textContent='';
    g5Feedback.className='feedback';
    g5Solution.textContent='';
    g5Progress.textContent = `${g5Index+1} / ${g5Tasks.length}`;
  }

  g5CheckBtn.addEventListener('click', ()=>{
    const task = g5Tasks[g5Index];
    const user = normalize(g5Input.value);
    const correct = normalize(task.solution);
    if(!user){
      g5Feedback.textContent = "Schreiw fir d'éischt eppes.";
      g5Feedback.className = 'feedback bad';
      return;
    }
    if(user === correct){
      g5Feedback.textContent = "Super, dat ass genee esou geschriwwen!";
      g5Feedback.className = 'feedback ok';
      g5Solution.textContent = '';
    }else{
      g5Feedback.textContent = "Net ganz richteg.";
      g5Feedback.className = 'feedback bad';
      g5Solution.textContent = `Sou schreiwe mir et: ${task.solution}`;
    }
  });

  g5NextBtn.addEventListener('click', ()=>{
    g5Index = (g5Index+1) % g5Tasks.length;
    g5RenderTask();
  });

  /* QWERTZ keyboard with SHIFT */
  const keyboardRows = [
    ['q','w','e','r','t','z','u','i','o','p','ü','é'],
    ['a','s','d','f','g','h','j','k','l','ë','ä'],
    ['y','x','c','v','b','n','m'],
    ['SHIFT','SPACE','BACK']
  ];

  let shiftActive = false;

  function addKey(text, wide=false){
    const btn = document.createElement('button');
    btn.className = 'g5-key' + (wide?' wide':'');
    btn.dataset.key = text;
    btn.textContent = (text==='SPACE') ? '␣' : (text==='BACK' ? '⌫' : text);
    btn.addEventListener('click', ()=>{
      if(text==='SPACE'){
        g5Input.value += ' ';
      }else if(text==='BACK'){
        g5Input.value = g5Input.value.slice(0,-1);
      }else if(text==='SHIFT'){
        shiftActive = !shiftActive;
        btn.classList.toggle('shift-active', shiftActive);
        return;
      }else{
        const ch = shiftActive ? text.toUpperCase() : text;
        g5Input.value += ch;
        if(shiftActive){
          // reset shift after one key
          shiftActive = false;
          const shiftBtn = g5Keyboard.querySelector('[data-key="SHIFT"]');
          if(shiftBtn) shiftBtn.classList.remove('shift-active');
        }
      }
      g5Input.focus();
    });
    return btn;
  }

  keyboardRows.forEach(row=>{
    const rowDiv = document.createElement('div');
    rowDiv.className='g5-row';
    row.forEach(key=>{
      const wide = (key==='SPACE'||key==='BACK'||key==='SHIFT');
      rowDiv.appendChild(addKey(key,wide));
    });
    g5Keyboard.appendChild(rowDiv);
  });

  g5RenderTask();

  // start on game 1
  setGame(0);
</script>
</body>
</html>

