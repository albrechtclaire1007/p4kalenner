<!DOCTYPE html>
<html lang="lb">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>P4 – De Kalenner</title>
  <style>
    /* Font */
    @font-face{
      font-family:'Schoulschrëft';
      src:url('https://raw.githubusercontent.com/albrechtclaire1007/schoulschreft/main/schoulschreft_bold%5B2%5D.TTF') format('truetype');
      font-weight:bold;
      font-style:normal;
      font-display:swap;
    }

    :root{
      --purple-mid:#b7a2e5;
      --purple-light:#ebe3ff;
      --purple-dark:#6c4aa3;
      --ink:#2d1844;
      --white:#fff;
      --ok:#b7f0c8;
      --bad:#ffcccc;
      --radius:18px;
    }

    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family:'Schoulschrëft', system-ui, sans-serif;
      background:var(--purple-light);
      color:var(--ink);
      min-height:100vh;
      padding:16px;
    }
    button{
      font-family:'Schoulschrëft', system-ui, sans-serif;
    }

    .top-bar{
      max-width:1100px;
      margin:0 auto 8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      background:var(--purple-mid);
      border-radius:999px;
      padding:4px 10px;
      color:var(--white);
    }
    .top-bar-title{
      font-size:1.05rem;
      text-align:center;
      flex:1;
    }
    .top-arrow{
      width:28px;
      height:28px;
      border-radius:50%;
      border:2px solid var(--white);
      background:transparent;
      color:var(--white);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-size:1.1rem;
    }
    .top-arrow:disabled{
      opacity:0.4;
      cursor:default;
    }

    .subtitle{
      max-width:1100px;
      margin:0 auto 12px;
      text-align:center;
      font-size:0.9rem;
      opacity:0.8;
    }

    .games{
      max-width:1100px;
      margin:0 auto;
      min-height:320px;
    }
    .game{
      display:none;
      animation:fadeIn .25s ease-out;
    }
    .game.active{display:block;}

    @keyframes fadeIn{
      from{opacity:0;transform:translateY(4px);}
      to{opacity:1;transform:translateY(0);}
    }

    .game h2{
      font-size:1.1rem;
      margin-bottom:4px;
      color:var(--purple-dark);
      text-align:center;
    }
    .instructions{
      font-size:0.9rem;
      margin-bottom:10px;
      text-align:center;
    }

    button.primary{
      padding:6px 14px;
      border-radius:999px;
      border:2px solid var(--purple-dark);
      background:var(--purple-mid);
      color:var(--white);
      font-size:0.9rem;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
      margin-bottom:6px;
    }
    button.secondary{
      padding:4px 10px;
      border-radius:999px;
      border:2px solid var(--purple-mid);
      background:var(--white);
      color:var(--ink);
      font-size:0.85rem;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
      margin-top:2px;
    }
    button:disabled{
      opacity:0.5;
      cursor:default;
    }

    .feedback{
      margin-top:6px;
      min-height:1.4em;
      font-size:0.9rem;
      text-align:left;
    }
    .feedback.ok{color:#117a3a;}
    .feedback.bad{color:#b02323;}

    /* GAME 1 – Lauschter a klick */
    .g1-layout{
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:center;
    }
    @media(min-width:780px){
      .g1-layout{
        flex-direction:row;
        align-items:flex-start;
        justify-content:center;
      }
    }
    .g1-left{
      flex:0 0 240px;
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:flex-start;
    }
    .audio-btn{
      width:56px;
      height:56px;
      border-radius:50%;
      border:3px solid var(--purple-dark);
      background:var(--purple-mid);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      box-shadow:0 3px 0 rgba(0,0,0,0.15);
      transition:.12s;
    }
    .audio-btn span{
      width:0;
      height:0;
      border-top:10px solid transparent;
      border-bottom:10px solid transparent;
      border-left:16px solid #fff;
      margin-left:2px;
    }
    .audio-label{
      font-size:0.9rem;
    }

    .g1-calendar{
      flex:1 1 auto;
      max-width:600px;
      background:var(--white);
      border-radius:24px;
      padding:10px 14px 14px;
      box-shadow:0 6px 16px rgba(0,0,0,0.12);
    }
    .g1-cal-title{
      text-align:center;
      font-size:1rem;
      margin-bottom:6px;
      color:var(--purple-dark);
    }
    .g1-weekdays{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      font-size:0.8rem;
      margin-bottom:4px;
      text-align:center;
      opacity:0.8;
    }
    .g1-weekdays div{
      padding:2px 0;
    }
    .g1-cal-grid{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:3px;
    }
    .g1-day{
      height:48px;
      border-radius:12px;
      border:2px solid #e0d6ff;
      background:#fdfbff;
      font-size:0.9rem;
      cursor:pointer;
      display:flex;
      align-items:flex-start;
      justify-content:flex-end;
      padding:3px 5px;
    }
    .g1-day.correct{
      background:var(--ok);
      border-color:#169451;
    }
    .g1-day.wrong{
      background:var(--bad);
      border-color:#a52828;
      animation:shake .16s linear;
    }
    @keyframes shake{
      0%{transform:translateX(0);}
      25%{transform:translateX(-3px);}
      50%{transform:translateX(3px);}
      75%{transform:translateX(-2px);}
      100%{transform:translateX(0);}
    }

    /* GAME 2 – Lies a klick */
    .g2-wrapper{
      max-width:600px;
      margin:0 auto;
    }
    .g2-question{
      font-size:1rem;
      margin-bottom:8px;
      text-align:center;
    }
    .g2-options{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(110px,1fr));
      gap:6px;
    }
    .g2-options button{
      padding:6px;
      border-radius:var(--radius);
      border:2px solid var(--purple-mid);
      background:var(--white);
      cursor:pointer;
      font-size:0.9rem;
    }
    .g2-options button.correct{
      background:var(--ok);
      border-color:#169451;
    }
    .g2-options button.wrong{
      background:var(--bad);
      border-color:#a52828;
    }

    /* GAME 3 – wheels */
    .g3-display{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
      margin-top:6px;
    }
    .wheels{
      display:flex;
      align-items:center;
      gap:3px;
      padding:10px 14px;
      border-radius:18px;
      background:var(--white);
      border:2px solid var(--purple-mid);
      font-size:1.4rem;
      box-shadow:0 5px 12px rgba(0,0,0,0.12);
    }
    .wheel{
      width:26px;
      height:40px;
      border-radius:10px;
      border:2px solid var(--purple-mid);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      position:relative;
      background:#f9f5ff;
    }
    .wheel span{
      position:absolute;
      animation:none;
    }
    .dot{
      font-size:1.4rem;
      padding:0 3px;
    }
    @keyframes wheelSpin{
      0%{transform:translateY(-110%);}
      100%{transform:translateY(0);}
    }
    .g3-buttons{
      display:flex;
      gap:8px;
      margin-top:2px;
    }

    /* GAME 4 – matching */
    .g4-layout{
      display:grid;
      grid-template-columns:1.1fr 0.9fr;
      gap:12px;
      margin-top:6px;
      align-items:flex-start;
    }
    @media(max-width:900px){
      .g4-layout{
        grid-template-columns:1fr;
      }
    }
    .g4-box{
      border-radius:24px;
      background:rgba(183,162,229,0.15);
      padding:8px;
      box-shadow:0 5px 12px rgba(0,0,0,0.08);
    }
    .g4-box h3{
      font-size:0.95rem;
      margin-bottom:4px;
      color:var(--purple-dark);
      text-align:center;
    }
    .g4-list{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
      gap:4px;
    }
    .g4-item{
      padding:5px 7px;
      border-radius:14px;
      border:2px solid var(--purple-mid);
      background:#fff;
      font-size:0.9rem;
      cursor:pointer;
    }
    .g4-item.selected{
      border-color:var(--purple-dark);
      box-shadow:0 0 0 2px rgba(108,74,163,0.2);
    }
    .g4-item.matched{
      background:var(--ok);
      border-color:#169451;
    }
    .g4-cards{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:2px;
      justify-content:center;
    }
    .g4-card{
      padding:5px 9px;
      border-radius:999px;
      border:2px solid var(--purple-mid);
      background:#fff;
      cursor:pointer;
      font-size:0.9rem;
    }
    .g4-card.used{
      opacity:0.4;
      cursor:default;
    }

    /* GAME 5 – write date */
    .g5-wrapper{
      max-width:800px;
      margin:0 auto;
    }
    .g5-prompt{
      font-size:1.0rem;
      margin-bottom:6px;
      text-align:left;
    }
    .g5-input-row{
      display:flex;
      flex-direction:column;
      gap:4px;
      margin-bottom:4px;
    }
    .g5-input-row input{
      width:100%;
      padding:6px 8px;
      border-radius:999px;
      border:2px solid var(--purple-mid);
      font-size:0.95rem;
      font-family:'Schoulschrëft', system-ui, sans-serif;
      background:#fff;
    }
    .g5-keyboard{
      display:flex;
      flex-direction:column;
      gap:3px;
      margin:4px 0 6px;
      align-items:center;
    }
    .g5-row{
      display:flex;
      flex-wrap:wrap;
      gap:3px;
      justify-content:center;
    }
    .g5-key{
      min-width:26px;
      padding:4px 6px;
      border-radius:8px;
      border:1px solid var(--purple-mid);
      background:#fff;
      font-size:0.8rem;
      cursor:pointer;
      text-align:center;
    }
    .g5-key.wide{
      min-width:50px;
    }
    .g5-key.shift-active{
      background:var(--purple-mid);
      color:var(--white);
    }
    .solution{
      margin-top:2px;
      font-size:0.8rem;
      opacity:0.85;
    }
    .progress{
      margin-top:2px;
      font-size:0.8rem;
      opacity:0.8;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <button id="topPrev" class="top-arrow">‹</button>
    <div id="topTitle" class="top-bar-title">1. Lauschter a klick</div>
    <button id="topNext" class="top-arrow">›</button>
  </div>
  <p class="subtitle">P4 – De Kalenner: Datumer liesen a schreiwen</p>

  <div class="games">
    <!-- GAME 1 -->
    <section id="game1" class="game active">
      <h2>1. Lauschter a klick</h2>
      <p class="instructions">Lauschter den Datum a klick duerno op déi richteg Zuel um Kalenner.</p>
      <div class="g1-layout">
        <div class="g1-left">
          <button id="g1PlayBtn" class="audio-btn" title="Lauschteren">
            <span></span>
          </button>
          <p class="audio-label">Klick op de Knäppchen fir ze lauschteren an duerno op den Datum.</p>
          <button id="g1NextBtn" class="secondary">Nächsten Datum</button>
          <div id="g1Feedback" class="feedback"></div>
        </div>
        <div class="g1-calendar">
          <div class="g1-cal-title">Kalenner</div>
          <div class="g1-weekdays">
            <div>Mo</div><div>Di</div><div>Më</div><div>Do</div><div>Fr</div><div>Sa</div><div>So</div>
          </div>
          <div class="g1-cal-grid" id="g1CalGrid"></div>
        </div>
      </div>
    </section>

    <!-- GAME 2 -->
    <section id="game2" class="game">
      <h2>2. Lies a klick</h2>
      <p class="instructions">Lies den Datum a klick op déi richteg Zueleschreifweis.</p>
      <div class="g2-wrapper">
        <div id="g2Question" class="g2-question"></div>
        <div id="g2Options" class="g2-options"></div>
        <div style="margin-top:6px;display:flex;justify-content:center;gap:8px;">
          <button id="g2NextBtn" class="secondary">Nächst Fro</button>
        </div>
        <div id="g2Feedback" class="feedback"></div>
      </div>
    </section>

    <!-- GAME 3 -->
    <section id="game3" class="game">
      <h2>3. Lies den Datum</h2>
      <p class="instructions">Kuck op d'Zuelen a lies de ganzen Datum vir (Dag, Mount an d'Joer).</p>
      <div class="g3-display">
        <div class="wheels" id="g3Wheels">
          <div class="wheel" data-pos="0"><span>0</span></div>
          <div class="wheel" data-pos="1"><span>1</span></div>
          <div class="dot">.</div>
          <div class="wheel" data-pos="2"><span>0</span></div>
          <div class="wheel" data-pos="3"><span>1</span></div>
          <div class="dot">.</div>
          <div class="wheel" data-pos="4"><span>2</span></div>
          <div class="wheel" data-pos="5"><span>0</span></div>
          <div class="wheel" data-pos="6"><span>2</span></div>
          <div class="wheel" data-pos="7"><span>4</span></div>
        </div>
        <div class="g3-buttons">
          <button id="g3PrevBtn" class="secondary">◀️ Zréck</button>
          <button id="g3NextBtn" class="primary">▶️ Nächsten Datum</button>
        </div>
      </div>
    </section>

    <!-- GAME 4 -->
    <section id="game4" class="game">
      <h2>4. Fann de passenden Datum</h2>
      <p class="instructions">Wielt e Saz a klick duerno op déi passend Zueleschreifweis.</p>
      <div class="g4-layout">
        <div class="g4-box">
          <h3>Datumer am Saz</h3>
          <div id="g4List" class="g4-list"></div>
        </div>
        <div class="g4-box">
          <h3>Zueleschreifweis</h3>
          <div id="g4Cards" class="g4-cards"></div>
        </div>
      </div>
      <div style="margin-top:6px;display:flex;justify-content:center;">
        <button id="g4ResetBtn" class="secondary">Nach eng Kéier</button>
      </div>
      <div id="g4Feedback" class="feedback"></div>
    </section>

    <!-- GAME 5 -->
    <section id="game5" class="game">
      <h2>5. Schreif den Datum</h2>
      <div class="g5-wrapper">
        <div id="g5Prompt" class="g5-prompt"></div>
        <div class="g5-input-row">
          <input id="g5Input" type="text" autocomplete="off"
                 placeholder="Den éischte Januar ..." />
        </div>
        <div class="g5-keyboard" id="g5Keyboard"></div>
        <div style="display:flex;gap:8px;margin-bottom:4px;">
          <button id="g5CheckBtn" class="primary">Kontrolléier</button>
          <button id="g5NextBtn" class="secondary">Nächst</button>
        </div>
        <div id="g5Feedback" class="feedback"></div>
        <div id="g5Solution" class="solution"></div>
        <div id="g5Progress" class="progress"></div>
      </div>
    </section>
  </div>

  <script>
/* ----------------------------------------------------------  
   UNIVERSAL HELPERS  
-----------------------------------------------------------*/

/* Shuffle helper */
function shuffle(array){
  return array.map(v=>({v,sort:Math.random()}))
              .sort((a,b)=>a.sort-b.sort)
              .map(({v})=>v);
}

/* Pad helper */
function pad(num, len){
  return num.toString().padStart(len,'0');
}

/* ----------------------------------------------------------  
   LUXEMBOURGISH GRAMMAR ENGINE  
   - Correct ordinals 1–31  
   - Correct "den/de" rule  
   - Correct month-based -n rule  
-----------------------------------------------------------*/

const MONTHS = [
  "Januar", "Februar", "Mäerz", "Abrëll", "Mee", "Juni",
  "Juli", "August", "September", "Oktober", "November", "Dezember"
];

/* Ordinals without month context */
const ORDINAL = {
  1: "den éischten",
  2: "den zweeten",
  3: "den drëtten",
  4: "de véierten",
  5: "de fënneften",
  6: "de sechsten",
  7: "de siwenten",
  8: "den aachten",
  9: "den néngten",
  10: "den zéngten",
  11: "den eeleften",
  12: "den zwieleften",
  13: "den dräizéngten",
  14: "de véierzéngten",
  15: "de fofzéngten",
  16: "de siechzéngten",
  17: "de siwwenzéngten",
  18: "den uechtzéngten",
  19: "den nonzéngten",
  20: "den zwanzegsten",
  21: "den eenanzwanzegsten",
  22: "den zweeanzwanzegsten",
  23: "den dräianzwanzegsten",
  24: "den véieranzwanzegsten",
  25: "den fënnefanzwanzegsten",
  26: "den sechsanzwanzegsten",
  27: "den siwenanzwanzegsten",
  28: "den aachtanzwanzegsten",
  29: "den nénganzwanzegsten",
  30: "den drëssegsten",
  31: "den eenendrëssegsten"
};

/* Letters that trigger “den” */
const N_RULE = ["u","n","i","t","e","d","z","o","a","h","é"];

/* Adjust ordinal with month-based -n rule */
function applyMonthNRule(ordinal, monthName){
  const first = monthName.trim().toLowerCase()[0];
  const requiresN = N_RULE.includes(first);

  if(requiresN){
    if(!ordinal.endsWith("n")) return ordinal + "n";
    return ordinal;
  } else {
    if(ordinal.endsWith("n")){
      return ordinal.replace(/n$/, "");
    }
    return ordinal;
  }
}

/* Convert 1–31 → full written date */
function fullDateWritten(day, monthIdx){
  let base = ORDINAL[day];
  let adjusted = applyMonthNRule(base, MONTHS[monthIdx]);
  return `${adjusted} ${MONTHS[monthIdx]}`;
}

/* ----------------------------------------------------------  
   TOP BAR NAVIGATION  
-----------------------------------------------------------*/

const games = document.querySelectorAll('.game');
const topTitle = document.getElementById('topTitle');
const topPrev = document.getElementById('topPrev');
const topNext = document.getElementById('topNext');

const gameTitles = [
  '1. Lauschter a klick',
  '2. Lies a klick',
  '3. Lies den Datum',
  '4. Fann de passenden Datum',
  '5. Schreif den Datum'
];

let currentGameIndex = 0;

function setGame(index){
  currentGameIndex = index;
  games.forEach(g=>g.classList.remove('active'));
  games[index].classList.add('active');
  topTitle.textContent = gameTitles[index];
  topPrev.disabled = index===0;
  topNext.disabled = index===games.length-1;
}

topPrev.onclick = ()=>{ if(currentGameIndex>0) setGame(currentGameIndex-1); };
topNext.onclick = ()=>{ if(currentGameIndex<4) setGame(currentGameIndex+1); };

/* ----------------------------------------------------------  
   GAME 1 — AUTOPLAY AUDIO + CALENDAR  
-----------------------------------------------------------*/

const AUDIO_BASE_URL =
  "https://github.com/albrechtclaire1007/p4kalenner/raw/refs/heads/main/";

const g1Audio = new Audio();
const g1PlayBtn = document.getElementById('g1PlayBtn');
const g1NextBtn = document.getElementById('g1NextBtn');
const g1Feedback = document.getElementById('g1Feedback');
const g1CalGrid = document.getElementById('g1CalGrid');

const g1Days = [];
for(let d=1; d<=31; d++){
  const btn=document.createElement('button');
  btn.className='g1-day';
  btn.textContent=d;
  btn.dataset.day=d;
  g1CalGrid.appendChild(btn);
  g1Days.push(btn);
}

let g1CurrentDay=null;
let g1Locked=false;

function g1SetTask(){
  g1Locked=false;
  g1Feedback.textContent='Lauschter an da klick op den Datum.';
  g1Days.forEach(c=>c.classList.remove('correct','wrong'));

  g1CurrentDay = Math.floor(Math.random()*31)+1;
  const file = `P4__${g1CurrentDay}..mp3`;
  g1Audio.src = AUDIO_BASE_URL + file;

  /* Browser-safe autoplay */
  g1Audio.play().catch(()=>{
    // will play when user touches screen
  });
}

g1PlayBtn.onclick = ()=>{
  g1Audio.currentTime=0;
  g1Audio.play();
};

g1Days.forEach(btn=>{
  btn.onclick = ()=>{
    if(g1Locked) return;
    const chosen = Number(btn.dataset.day);
    if(chosen===g1CurrentDay){
      btn.classList.add('correct');
      g1Feedback.textContent=`Super! Dat war den ${chosen}.`;
      g1Locked=true;
    } else {
      btn.classList.add('wrong');
      setTimeout(()=>btn.classList.remove('wrong'),200);
      g1Feedback.textContent="Nee, nach eng Kéier.";
    }
  };
});

g1NextBtn.onclick = g1SetTask;
g1SetTask();

/* ----------------------------------------------------------  
   GAME 2 — NEW CHECK BUTTON + DISPLAY SPELL-OUT  
-----------------------------------------------------------*/

const g2QuestionEl = document.getElementById('g2Question');
const g2OptionsEl = document.getElementById('g2Options');
const g2Feedback = document.getElementById('g2Feedback');

const g2NextBtn = document.getElementById('g2NextBtn');

/* NEW BUTTON */
const g2CheckWrittenBtn = document.createElement('button');
g2CheckWrittenBtn.textContent = "Weis mer de geschriwwenen Datum";
g2CheckWrittenBtn.className = "secondary";
g2CheckWrittenBtn.style.marginTop = "6px";
g2QuestionEl.parentNode.appendChild(g2CheckWrittenBtn);

/* Build 1–31 tasks with months */
let g2Tasks = [];
for(let i=0;i<25;i++){
  const day = Math.floor(Math.random()*31)+1;
  const monthIdx = Math.floor(Math.random()*12);

  const text = fullDateWritten(day, monthIdx);
  const correct = `${pad(day,2)}.${pad(monthIdx+1,2)}.`;

  const others = [];
  while(others.length<4){
    let d2=Math.floor(Math.random()*31)+1;
    let m2=Math.floor(Math.random()*12);
    let w=`${pad(d2,2)}.${pad(m2+1,2)}.`;
    if(w!==correct && !others.includes(w)) others.push(w);
  }

  g2Tasks.push({day,monthIdx,text,correct,others});
}

let g2Order = shuffle([...Array(g2Tasks.length).keys()]);
let g2Index = 0;
let g2CurrentTask = null;

function g2RenderTask(){
  g2Feedback.textContent="";
  g2OptionsEl.innerHTML="";
  g2CheckWrittenBtn.onclick = null;

  const idx = g2Order[g2Index];
  g2CurrentTask = g2Tasks[idx];

  g2QuestionEl.textContent = g2CurrentTask.text;

  const opts = shuffle([g2CurrentTask.correct, ...g2CurrentTask.others]);

  opts.forEach(opt=>{
    const b=document.createElement('button');
    b.textContent=opt;
    b.onclick=()=>{
      [...g2OptionsEl.children].forEach(btn=>btn.disabled=true);

      if(opt===g2CurrentTask.correct){
        b.classList.add("correct");
        g2Feedback.textContent="Super!";
        g2Feedback.className="feedback ok";
      } else {
        b.classList.add("wrong");
        g2Feedback.textContent=
          `Nee, richteg wier: ${g2CurrentTask.correct}`;
        g2Feedback.className="feedback bad";
        [...g2OptionsEl.children].forEach(btn=>{
          if(btn.textContent===g2CurrentTask.correct){
            btn.classList.add("correct");
          }
        });
      }
    };
    g2OptionsEl.appendChild(b);
  });

  /* NEW — Show spelled-out date */
  g2CheckWrittenBtn.onclick = ()=>{
    const spelled = fullDateWritten(
      g2CurrentTask.day,
      g2CurrentTask.monthIdx
    );
    g2Feedback.textContent = spelled;
    g2Feedback.className = "feedback ok";
  };
}

g2NextBtn.onclick = ()=>{
  g2Index++;
  if(g2Index>=g2Order.length){
    g2Order = shuffle([...Array(g2Tasks.length).keys()]);
    g2Index=0;
  }
  g2RenderTask();
};

g2RenderTask();

/* ----------------------------------------------------------  
   GAME 3 — WHEELS + NEW BIG DATE DISPLAY  
-----------------------------------------------------------*/

const g3Wheels = document.querySelectorAll('.wheel');
const g3PrevBtn = document.getElementById('g3PrevBtn');
const g3NextBtn = document.getElementById('g3NextBtn');

/* NEW: Big date display pill */
const g3Display = document.createElement('div');
g3Display.style.marginBottom="10px";
g3Display.style.padding="8px 14px";
g3Display.style.borderRadius="999px";
g3Display.style.fontSize="1.6rem";
g3Display.style.background="#fff";
g3Display.style.border="2px solid var(--purple-mid)";
g3Display.style.boxShadow="0 4px 12px rgba(0,0,0,0.10)";
document.getElementById('game3').querySelector('.g3-display')
  .insertBefore(g3Display,
                document.getElementById('game3').querySelector('.wheels'));

function daysInMonth(m,y){ return new Date(y,m,0).getDate(); }

let g3History=[];
let g3Pointer=-1;

function randomDate(){
  const y=2000+Math.floor(Math.random()*30);
  const m=1+Math.floor(Math.random()*12);
  const d=1+Math.floor(Math.random()*daysInMonth(m,y));
  return {day:d,month:m,year:y};
}

function digitsFrom(d){
  return `${pad(d.day,2)}${pad(d.month,2)}${pad(d.year,4)}`.split("");
}

function setBigDate(d){
  g3Display.textContent = `${pad(d.day,2)}.${pad(d.month,2)}.${d.year}`;
}

function animateWheel(w,i){
  const span=w.querySelector('span');
  span.style.animation="none";
  span.offsetHeight;
  span.textContent=i;
  span.style.animation="wheelSpin .25s ease-out";
}

function showDate(d,push=true){
  const dig=digitsFrom(d);
  g3Wheels.forEach((w,i)=>animateWheel(w,dig[i]));
  setBigDate(d);

  if(push){
    g3History.splice(g3Pointer+1);
    g3History.push(d);
    g3Pointer=g3History.length-1;
  }
  g3PrevBtn.disabled = g3Pointer<=0;
}

g3NextBtn.onclick = ()=>showDate(randomDate(),true);
g3PrevBtn.onclick = ()=>{
  if(g3Pointer>0){
    g3Pointer--;
    showDate(g3History[g3Pointer],false);
  }
};

showDate(randomDate(),true);

/* ----------------------------------------------------------  
   GAME 4 — Matching (unchanged except grammar handled above)  
-----------------------------------------------------------*/

g4Render();

/* ----------------------------------------------------------  
   GAME 5 — Writing (ordinal logic now handled by grammar engine)  
-----------------------------------------------------------*/

g5RenderTask();

/* Start at game 1 */
setGame(0);
</script>
</body>
</html>

