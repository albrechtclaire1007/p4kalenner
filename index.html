<!DOCTYPE html>
<html lang="lb">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>P4 – De Kalenner</title>
  <style>
    /* Font */
    @font-face{
      font-family:'Schoulschrëft';
      src:url('https://raw.githubusercontent.com/albrechtclaire1007/schoulschreft/main/schoulschreft_bold%5B2%5D.TTF') format('truetype');
      font-weight:bold;
      font-style:normal;
      font-display:swap;
    }

    :root{
      --purple-mid:#b7a2e5;
      --purple-light:#ebe3ff;
      --purple-dark:#6c4aa3;
      --ink:#2d1844;
      --white:#fff;
      --ok:#b7f0c8;
      --bad:#ffcccc;
      --radius:18px;
    }

    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family:'Schoulschrëft', system-ui, sans-serif;
      background:var(--purple-light);
      color:var(--ink);
      min-height:100vh;
      padding:16px;
    }
    button{
      font-family:'Schoulschrëft', system-ui, sans-serif;
    }

    .top-bar{
      max-width:1100px;
      margin:0 auto 8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      background:var(--purple-mid);
      border-radius:999px;
      padding:4px 10px;
      color:var(--white);
    }
    .top-bar-title{
      font-size:1.05rem;
      text-align:center;
      flex:1;
    }
    .top-arrow{
      width:28px;
      height:28px;
      border-radius:50%;
      border:2px solid var(--white);
      background:transparent;
      color:var(--white);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-size:1.1rem;
    }
    .top-arrow:disabled{
      opacity:0.4;
      cursor:default;
    }

    .subtitle{
      max-width:1100px;
      margin:0 auto 12px;
      text-align:center;
      font-size:0.9rem;
      opacity:0.8;
    }

    .games{
      max-width:1100px;
      margin:0 auto;
      min-height:320px;
    }
    .game{
      display:none;
      animation:fadeIn .25s ease-out;
    }
    .game.active{display:block;}

    @keyframes fadeIn{
      from{opacity:0;transform:translateY(4px);}
      to{opacity:1;transform:translateY(0);}
    }

    .game h2{
      font-size:1.1rem;
      margin-bottom:4px;
      color:var(--purple-dark);
      text-align:center;
    }
    .instructions{
      font-size:0.9rem;
      margin-bottom:10px;
      text-align:center;
    }

    button.primary{
      padding:6px 14px;
      border-radius:999px;
      border:2px solid var(--purple-dark);
      background:var(--purple-mid);
      color:var(--white);
      font-size:0.9rem;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
      margin-bottom:6px;
    }
    button.secondary{
      padding:4px 10px;
      border-radius:999px;
      border:2px solid var(--purple-mid);
      background:var(--white);
      color:var(--ink);
      font-size:0.85rem;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
      margin-top:2px;
    }
    button:disabled{
      opacity:0.5;
      cursor:default;
    }

    .feedback{
      margin-top:6px;
      min-height:1.4em;
      font-size:0.9rem;
      text-align:left;
    }
    .feedback.ok{color:#117a3a;}
    .feedback.bad{color:#b02323;}

    /* GAME 1 – Lauschter a klick */
    .g1-layout{
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:center;
    }
    @media(min-width:780px){
      .g1-layout{
        flex-direction:row;
        align-items:flex-start;
        justify-content:center;
      }
    }
    .g1-left{
      flex:0 0 240px;
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:flex-start;
    }
    .audio-btn{
      width:56px;
      height:56px;
      border-radius:50%;
      border:3px solid var(--purple-dark);
      background:var(--purple-mid);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      box-shadow:0 3px 0 rgba(0,0,0,0.15);
      transition:.12s;
    }
    .audio-btn span{
      width:0;
      height:0;
      border-top:10px solid transparent;
      border-bottom:10px solid transparent;
      border-left:16px solid #fff;
      margin-left:2px;
    }
    .audio-label{
      font-size:0.9rem;
    }

    .g1-calendar{
      flex:1 1 auto;
      max-width:600px;
      background:var(--white);
      border-radius:24px;
      padding:10px 14px 14px;
      box-shadow:0 6px 16px rgba(0,0,0,0.12);
    }
    .g1-cal-title{
      text-align:center;
      font-size:1rem;
      margin-bottom:6px;
      color:var(--purple-dark);
    }
    .g1-weekdays{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      font-size:0.8rem;
      margin-bottom:4px;
      text-align:center;
      opacity:0.8;
    }
    .g1-weekdays div{
      padding:2px 0;
    }
    .g1-cal-grid{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:3px;
    }
    .g1-day{
      height:48px;
      border-radius:12px;
      border:2px solid #e0d6ff;
      background:#fdfbff;
      font-size:0.9rem;
      cursor:pointer;
      display:flex;
      align-items:flex-start;
      justify-content:flex-end;
      padding:3px 5px;
    }
    .g1-day.correct{
      background:var(--ok);
      border-color:#169451;
    }
    .g1-day.wrong{
      background:var(--bad);
      border-color:#a52828;
      animation:shake .16s linear;
    }
    @keyframes shake{
      0%{transform:translateX(0);}
      25%{transform:translateX(-3px);}
      50%{transform:translateX(3px);}
      75%{transform:translateX(-2px);}
      100%{transform:translateX(0);}
    }

    /* GAME 2 – Lies a klick */
    .g2-wrapper{
      max-width:600px;
      margin:0 auto;
    }
    .g2-question{
      font-size:1rem;
      margin-bottom:8px;
      text-align:center;
    }
    .g2-options{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(110px,1fr));
      gap:6px;
    }
    .g2-options button{
      padding:6px;
      border-radius:var(--radius);
      border:2px solid var(--purple-mid);
      background:var(--white);
      cursor:pointer;
      font-size:0.9rem;
    }
    .g2-options button.correct{
      background:var(--ok);
      border-color:#169451;
    }
    .g2-options button.wrong{
      background:var(--bad);
      border-color:#a52828;
    }

    /* GAME 3 – wheels */
    .g3-display{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
      margin-top:6px;
    }
    .wheels{
      display:flex;
      align-items:center;
      gap:3px;
      padding:10px 14px;
      border-radius:18px;
      background:var(--white);
      border:2px solid var(--purple-mid);
      font-size:1.4rem;
      box-shadow:0 5px 12px rgba(0,0,0,0.12);
    }
    .wheel{
      width:26px;
      height:40px;
      border-radius:10px;
      border:2px solid var(--purple-mid);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      position:relative;
      background:#f9f5ff;
    }
    .wheel span{
      position:absolute;
      animation:none;
    }
    .dot{
      font-size:1.4rem;
      padding:0 3px;
    }
    @keyframes wheelSpin{
      0%{transform:translateY(-110%);}
      100%{transform:translateY(0);}
    }
    .g3-buttons{
      display:flex;
      gap:8px;
      margin-top:2px;
    }

    /* GAME 4 – matching */
    .g4-layout{
      display:grid;
      grid-template-columns:1.1fr 0.9fr;
      gap:12px;
      margin-top:6px;
      align-items:flex-start;
    }
    @media(max-width:900px){
      .g4-layout{
        grid-template-columns:1fr;
      }
    }
    .g4-box{
      border-radius:24px;
      background:rgba(183,162,229,0.15);
      padding:8px;
      box-shadow:0 5px 12px rgba(0,0,0,0.08);
    }
    .g4-box h3{
      font-size:0.95rem;
      margin-bottom:4px;
      color:var(--purple-dark);
      text-align:center;
    }
    .g4-list{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
      gap:4px;
    }
    .g4-item{
      padding:5px 7px;
      border-radius:14px;
      border:2px solid var(--purple-mid);
      background:#fff;
      font-size:0.9rem;
      cursor:pointer;
    }
    .g4-item.selected{
      border-color:var(--purple-dark);
      box-shadow:0 0 0 2px rgba(108,74,163,0.2);
    }
    .g4-item.matched{
      background:var(--ok);
      border-color:#169451;
    }
    .g4-cards{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:2px;
      justify-content:center;
    }
    .g4-card{
      padding:5px 9px;
      border-radius:999px;
      border:2px solid var(--purple-mid);
      background:#fff;
      cursor:pointer;
      font-size:0.9rem;
    }
    .g4-card.used{
      opacity:0.4;
      cursor:default;
    }

    /* GAME 5 – write date */
    .g5-wrapper{
      max-width:800px;
      margin:0 auto;
    }
    .g5-prompt{
      font-size:1.0rem;
      margin-bottom:6px;
      text-align:left;
    }
    .g5-input-row{
      display:flex;
      flex-direction:column;
      gap:4px;
      margin-bottom:4px;
    }
    .g5-input-row input{
      width:100%;
      padding:6px 8px;
      border-radius:999px;
      border:2px solid var(--purple-mid);
      font-size:0.95rem;
      font-family:'Schoulschrëft', system-ui, sans-serif;
      background:#fff;
    }
    .g5-keyboard{
      display:flex;
      flex-direction:column;
      gap:3px;
      margin:4px 0 6px;
      align-items:center;
    }
    .g5-row{
      display:flex;
      flex-wrap:wrap;
      gap:3px;
      justify-content:center;
    }
    .g5-key{
      min-width:26px;
      padding:4px 6px;
      border-radius:8px;
      border:1px solid var(--purple-mid);
      background:#fff;
      font-size:0.8rem;
      cursor:pointer;
      text-align:center;
    }
    .g5-key.wide{
      min-width:50px;
    }
    .g5-key.shift-active{
      background:var(--purple-mid);
      color:var(--white);
    }
    .solution{
      margin-top:2px;
      font-size:0.8rem;
      opacity:0.85;
    }
    .progress{
      margin-top:2px;
      font-size:0.8rem;
      opacity:0.8;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <button id="topPrev" class="top-arrow">‹</button>
    <div id="topTitle" class="top-bar-title">1. Lauschter a klick</div>
    <button id="topNext" class="top-arrow">›</button>
  </div>
  <p class="subtitle">P4 – De Kalenner: Datumer liesen a schreiwen</p>

  <div class="games">
    <!-- GAME 1 -->
    <section id="game1" class="game active">
      <h2>1. Lauschter a klick</h2>
      <p class="instructions">Lauschter den Datum a klick duerno op déi richteg Zuel um Kalenner.</p>
      <div class="g1-layout">
        <div class="g1-left">
          <button id="g1PlayBtn" class="audio-btn" title="Lauschteren">
            <span></span>
          </button>
          <p class="audio-label">Klick op de Knäppchen fir ze lauschteren an duerno op den Datum.</p>
          <button id="g1NextBtn" class="secondary">Nächsten Datum</button>
          <div id="g1Feedback" class="feedback"></div>
        </div>
        <div class="g1-calendar">
          <div class="g1-cal-title">Kalenner</div>
          <div class="g1-weekdays">
            <div>Mo</div><div>Di</div><div>Më</div><div>Do</div><div>Fr</div><div>Sa</div><div>So</div>
          </div>
          <div class="g1-cal-grid" id="g1CalGrid"></div>
        </div>
      </div>
    </section>

    <!-- GAME 2 -->
    <section id="game2" class="game">
      <h2>2. Lies a klick</h2>
      <p class="instructions">Lies den Datum a klick op déi richteg Zueleschreifweis.</p>
      <div class="g2-wrapper">
        <div id="g2Question" class="g2-question"></div>
        <div id="g2Options" class="g2-options"></div>
        <div style="margin-top:6px;display:flex;justify-content:center;gap:8px;">
          <button id="g2NextBtn" class="secondary">Nächst Fro</button>
        </div>
        <div id="g2Feedback" class="feedback"></div>
      </div>
    </section>

    <!-- GAME 3 -->
    <section id="game3" class="game">
      <h2>3. Lies den Datum</h2>
      <p class="instructions">Kuck op d'Zuelen a lies de ganzen Datum vir (Dag, Mount an d'Joer).</p>
      <div class="g3-display">
        <div class="wheels" id="g3Wheels">
          <div class="wheel" data-pos="0"><span>0</span></div>
          <div class="wheel" data-pos="1"><span>1</span></div>
          <div class="dot">.</div>
          <div class="wheel" data-pos="2"><span>0</span></div>
          <div class="wheel" data-pos="3"><span>1</span></div>
          <div class="dot">.</div>
          <div class="wheel" data-pos="4"><span>2</span></div>
          <div class="wheel" data-pos="5"><span>0</span></div>
          <div class="wheel" data-pos="6"><span>2</span></div>
          <div class="wheel" data-pos="7"><span>4</span></div>
        </div>
        <div class="g3-buttons">
          <button id="g3PrevBtn" class="secondary">◀️ Zréck</button>
          <button id="g3NextBtn" class="primary">▶️ Nächsten Datum</button>
        </div>
      </div>
    </section>

    <!-- GAME 4 -->
    <section id="game4" class="game">
      <h2>4. Fann de passenden Datum</h2>
      <p class="instructions">Wielt e Saz a klick duerno op déi passend Zueleschreifweis.</p>
      <div class="g4-layout">
        <div class="g4-box">
          <h3>Datumer am Saz</h3>
          <div id="g4List" class="g4-list"></div>
        </div>
        <div class="g4-box">
          <h3>Zueleschreifweis</h3>
          <div id="g4Cards" class="g4-cards"></div>
        </div>
      </div>
      <div style="margin-top:6px;display:flex;justify-content:center;">
        <button id="g4ResetBtn" class="secondary">Nach eng Kéier</button>
      </div>
      <div id="g4Feedback" class="feedback"></div>
    </section>

    <!-- GAME 5 -->
    <section id="game5" class="game">
      <h2>5. Schreif den Datum</h2>
      <div class="g5-wrapper">
        <div id="g5Prompt" class="g5-prompt"></div>
        <div class="g5-input-row">
          <input id="g5Input" type="text" autocomplete="off"
                 placeholder="Den éischte Januar ..." />
        </div>
        <div class="g5-keyboard" id="g5Keyboard"></div>
        <div style="display:flex;gap:8px;margin-bottom:4px;">
          <button id="g5CheckBtn" class="primary">Kontrolléier</button>
          <button id="g5NextBtn" class="secondary">Nächst</button>
        </div>
        <div id="g5Feedback" class="feedback"></div>
        <div id="g5Solution" class="solution"></div>
        <div id="g5Progress" class="progress"></div>
      </div>
    </section>
  </div>

<script>
  /* ------------ NAV & TOP BAR ------------ */
  const games = document.querySelectorAll('.game');
  const topTitle = document.getElementById('topTitle');
  const topPrev = document.getElementById('topPrev');
  const topNext = document.getElementById('topNext');

  const gameTitles = [
    '1. Lauschter a klick',
    '2. Lies a klick',
    '3. Lies den Datum',
    '4. Fann de passenden Datum',
    '5. Schreif den Datum'
  ];

  let currentGameIndex = 0;

  function setGame(index){
    currentGameIndex = index;
    games.forEach(g=>g.classList.remove('active'));
    games[index].classList.add('active');
    topTitle.textContent = gameTitles[index];
    topPrev.disabled = (index===0);
    topNext.disabled = (index===games.length-1);
  }

  topPrev.addEventListener('click', ()=>{
    if(currentGameIndex>0) setGame(currentGameIndex-1);
  });
  topNext.addEventListener('click', ()=>{
    if(currentGameIndex<games.length-1) setGame(currentGameIndex+1);
  });

  /* small helper */
  function shuffle(array){
    return array
      .map(v=>({v, sort:Math.random()}))
      .sort((a,b)=>a.sort-b.sort)
      .map(({v})=>v);
  }

  /* ------------ GAME 1: Lauschter a klick ------------ */
  const AUDIO_BASE_URL =
    "https://github.com/albrechtclaire1007/p4kalenner/raw/refs/heads/main/";

  const g1Audio = new Audio();
  const g1PlayBtn = document.getElementById('g1PlayBtn');
  const g1NextBtn = document.getElementById('g1NextBtn');
  const g1Feedback = document.getElementById('g1Feedback');
  const g1CalGrid = document.getElementById('g1CalGrid');

  // build simple calendar 1–31
  const g1Days = [];
  for(let d=1; d<=31; d++){
    const btn = document.createElement('button');
    btn.className = 'g1-day';
    btn.textContent = d;
    btn.dataset.day = d;
    g1CalGrid.appendChild(btn);
    g1Days.push(btn);
  }

  let g1CurrentDay = null;
  let g1Locked = false;

  function g1SetTask(){
    g1Locked = false;
    g1Feedback.textContent = 'Lauschter an da klick op den Datum.';
    g1Feedback.className = 'feedback';
    g1Days.forEach(c=>{c.classList.remove('correct','wrong');});
    g1CurrentDay = Math.floor(Math.random()*31)+1;
    const filename = `P4__${g1CurrentDay}..mp3`;
    g1Audio.src = AUDIO_BASE_URL + filename;
  }

  g1PlayBtn.addEventListener('click', ()=>{
    if(!g1Audio.src) g1SetTask();
    g1Audio.currentTime = 0;
    g1Audio.play();
  });

  g1NextBtn.addEventListener('click', g1SetTask);

  g1Days.forEach(cell=>{
    cell.addEventListener('click', ()=>{
      if(g1Locked) return;
      const chosen = Number(cell.dataset.day);
      if(chosen === g1CurrentDay){
        cell.classList.add('correct');
        g1Feedback.textContent = `Super! Dat war den ${g1CurrentDay}.`;
        g1Feedback.className = 'feedback ok';
        g1Locked = true;
      }else{
        cell.classList.add('wrong');
        setTimeout(()=>cell.classList.remove('wrong'),200);
        g1Feedback.textContent = 'Nee, probéier nach eng Kéier.';
        g1Feedback.className = 'feedback bad';
      }
    });
  });

  g1SetTask();

  /* ------------ GAME 2: Lies a klick ------------ */
  const g2QuestionEl = document.getElementById('g2Question');
  const g2OptionsEl = document.getElementById('g2Options');
  const g2Feedback = document.getElementById('g2Feedback');
  const g2NextBtn = document.getElementById('g2NextBtn');

  // ordinals follow N-rule: Den if ordinal starts with U N I T E D Z O A H (or é),
  // De otherwise. Forms with -e (éischte, zweete, drëtte, ...) as you requested.
  const g2Tasks = [
    {text:"Den éischte Januar",   correct:"01.01.",
      others:["10.01.","01.10.","11.01.","31.01."]},
    {text:"Den zweete Januar",   correct:"02.01.",
      others:["20.01.","02.10.","12.01.","21.01."]},
    {text:"Den drëtte Februar",  correct:"03.02.",
      others:["02.03.","30.02.","13.02.","03.12."]},
    {text:"De véierte Mäerz",    correct:"04.03.",
      others:["03.04.","14.03.","04.05.","24.03."]},
    {text:"De fënneften Abrëll",  correct:"05.04.",
      others:["04.05.","15.04.","05.06.","25.04."]},
    {text:"De sechste Mee",      correct:"06.05.",
      others:["05.06.","16.05.","06.03.","26.05."]},
    {text:"De siwente Juni",     correct:"07.06.",
      others:["06.07.","17.06.","07.09.","27.06."]},
    {text:"Den aachte Juli",     correct:"08.07.",
      others:["07.08.","18.07.","08.06.","28.07."]},
    {text:"Den néngten August",   correct:"09.08.",
      others:["19.08.","09.10.","29.08.","09.03."]},
    {text:"Den zéngte September",correct:"10.09.",
      others:["09.10.","01.09.","20.09.","10.11."]},
    {text:"Den eeleften Oktober",correct:"11.10.",
      others:["10.11.","21.10.","12.10.","11.01."]},
    {text:"Den zwieleften Oktober",correct:"12.10.",
      others:["21.12.","10.12.","02.10.","13.10."]},
    {text:"Den dräizéngte November",correct:"13.11.",
      others:["31.11.","13.01.","23.11.","03.11."]},
    {text:"De véierzéngte November",correct:"14.11.",
      others:["24.11.","14.01.","04.11.","10.04."]},
    {text:"De fofzéngte November",correct:"15.11.",
      others:["05.11.","25.11.","15.01.","11.05."]},
    {text:"De siechzéngten Dezember",correct:"16.12.",
      others:["06.12.","26.12.","10.12.","16.10."]},
    {text:"De siwwenzéngten Dezember",correct:"17.12.",
      others:["07.12.","27.12.","17.11.","10.07."]},
    {text:"Den uechtzéngten Dezember",correct:"18.12.",
      others:["08.12.","28.12.","18.10.","18.02."]},
    {text:"Den nonzéngten Dezember",correct:"19.12.",
      others:["09.12.","29.12.","10.09.","19.10."]},
    {text:"Den eenanzwanzegste Mee",correct:"21.05.",
      others:["12.05.","20.05.","21.03.","21.06."]}
  ];

  let g2Order = shuffle([...Array(g2Tasks.length).keys()]);
  let g2Index = 0;

  function g2RenderTask(){
    g2Feedback.textContent = '';
    g2Feedback.className = 'feedback';
    g2OptionsEl.innerHTML = '';

    if(g2Index >= g2Order.length){
      g2QuestionEl.textContent = "Super! Du bass fäerdeg mat dësem Spill.";
      g2Feedback.textContent = "Mir ginn elo bei d'Spill 3.";
      g2Feedback.className = "feedback ok";
      setTimeout(()=>setGame(2), 1200);
      return;
    }

    const task = g2Tasks[g2Order[g2Index]];
    g2QuestionEl.textContent = task.text;

    const options = shuffle([task.correct, ...task.others]);
    options.forEach(opt=>{
      const btn = document.createElement('button');
      btn.textContent = opt;
      btn.addEventListener('click', ()=>{
        const isCorrect = opt === task.correct;
        Array.from(g2OptionsEl.children).forEach(b=>b.disabled=true);
        if(isCorrect){
          btn.classList.add('correct');
          g2Feedback.textContent = "Super, dat ass richteg!";
          g2Feedback.className = 'feedback ok';
        }else{
          btn.classList.add('wrong');
          g2Feedback.textContent = `Nee, richteg wier: ${task.correct}`;
          g2Feedback.className = 'feedback bad';
          Array.from(g2OptionsEl.children).forEach(b=>{
            if(b.textContent===task.correct){
              b.classList.add('correct');
            }
          });
        }
      });
      g2OptionsEl.appendChild(btn);
    });
  }

  g2NextBtn.addEventListener('click', ()=>{
    g2Index++;
    if(g2Index >= g2Order.length){
      g2Order = shuffle([...Array(g2Tasks.length).keys()]);
      g2Index = 0;
    }
    g2RenderTask();
  });

  g2RenderTask();

  /* ------------ GAME 3: Spinning date wheels ------------ */
  const g3Wheels = document.querySelectorAll('.wheel');
  const g3PrevBtn = document.getElementById('g3PrevBtn');
  const g3NextBtn = document.getElementById('g3NextBtn');

  const g3History = [];
  let g3Pointer = -1;

  function daysInMonth(month, year){
    return new Date(year, month, 0).getDate();
  }

  function pad(num, len){
    return num.toString().padStart(len,'0');
  }

  function generateRandomDate(){
    const year = 2000 + Math.floor(Math.random()*100); // 2000–2099
    const month = 1 + Math.floor(Math.random()*12);
    const dim = daysInMonth(month, year);
    const day = 1 + Math.floor(Math.random()*dim);
    return {day, month, year};
  }

  function dateToDigits(d){
    const dd = pad(d.day,2);
    const mm = pad(d.month,2);
    const yyyy = pad(d.year,4);
    return (dd + mm + yyyy).split('');
  }

  function g3AnimateWheel(wheel, newDigit){
    const span = wheel.querySelector('span');
    span.style.animation = 'none';
    span.offsetHeight;
    span.textContent = newDigit;
    span.style.animation = 'wheelSpin .25s ease-out';
  }

  function g3ShowDate(d, pushToHistory=true){
    const digits = dateToDigits(d);
    g3Wheels.forEach((wheel,i)=>{
      g3AnimateWheel(wheel, digits[i]);
    });
    if(pushToHistory){
      g3History.splice(g3Pointer+1);
      g3History.push(d);
      g3Pointer = g3History.length-1;
    }
    g3PrevBtn.disabled = g3Pointer<=0;
  }

  g3NextBtn.addEventListener('click', ()=>{
    const d = generateRandomDate();
    g3ShowDate(d,true);
  });

  g3PrevBtn.addEventListener('click', ()=>{
    if(g3Pointer>0){
      g3Pointer--;
      const d = g3History[g3Pointer];
      g3ShowDate(d,false);
    }
  });

  g3ShowDate(generateRandomDate(), true);

  /* ------------ GAME 4: Matching ------------ */
  const g4ListEl = document.getElementById('g4List');
  const g4CardsEl = document.getElementById('g4Cards');
  const g4Feedback = document.getElementById('g4Feedback');
  const g4ResetBtn = document.getElementById('g4ResetBtn');

  // different examples than game 2 & 5
  const g4Pairs = [
    {id:1,  text:"Den drëtte Januar",         numeric:"03.01."},
    {id:2,  text:"De fënnefte Januar",        numeric:"05.01."},
    {id:3,  text:"De siwente Januar",         numeric:"07.01."},
    {id:4,  text:"Den éischte Februar",       numeric:"01.02."},
    {id:5,  text:"De véierte Februar",        numeric:"04.02."},
    {id:6,  text:"De sechste Februar",        numeric:"06.02."},
    {id:7,  text:"Den zweete Mäerz",          numeric:"02.03."},
    {id:8,  text:"De fënnefte Mäerz",         numeric:"05.03."},
    {id:9,  text:"Den aachte Mäerz",          numeric:"08.03."},
    {id:10, text:"Den éischten Abrëll",        numeric:"01.04."},
    {id:11, text:"Den drëtten Abrëll",         numeric:"03.04."},
    {id:12, text:"De sechsten Abrëll",         numeric:"06.04."},
    {id:13, text:"Den zweete Juni",           numeric:"02.06."},
    {id:14, text:"De véierte Juni",           numeric:"04.06."},
    {id:15, text:"Den aachte Juni",           numeric:"08.06."},
    {id:16, text:"Den éischte November",      numeric:"01.11."},
    {id:17, text:"Den drëtte November",       numeric:"03.11."},
    {id:18, text:"De fënnefte November",      numeric:"05.11."},
    {id:19, text:"Den zweete Dezember",       numeric:"02.12."},
    {id:20, text:"De véierte Dezember",       numeric:"04.12."}
  ];

  let g4SelectedSentenceId = null;

  function g4Render(){
    g4Feedback.textContent='';
    g4ListEl.innerHTML='';
    g4CardsEl.innerHTML='';
    g4SelectedSentenceId = null;

    const sentenceOrder = shuffle(g4Pairs.slice());
    sentenceOrder.forEach(pair=>{
      const item = document.createElement('div');
      item.className = 'g4-item';
      item.dataset.id = pair.id;
      item.textContent = pair.text;
      item.addEventListener('click', ()=>{
        if(item.classList.contains('matched')) return;
        Array.from(g4ListEl.children).forEach(el=>el.classList.remove('selected'));
        item.classList.add('selected');
        g4SelectedSentenceId = pair.id;
      });
      g4ListEl.appendChild(item);
    });

    const shuffledCards = shuffle(g4Pairs.slice());
    shuffledCards.forEach(pair=>{
      const card = document.createElement('div');
      card.className = 'g4-card';
      card.dataset.id = pair.id;
      card.textContent = pair.numeric;
      card.addEventListener('click', ()=>{
        if(card.classList.contains('used')) return;
        if(!g4SelectedSentenceId){
          g4Feedback.textContent = "Wielt fir d'éischt e Saz.";
          g4Feedback.className = 'feedback bad';
          return;
        }
        const correctId = card.dataset.id;
        if(Number(correctId) === Number(g4SelectedSentenceId)){
          const sentenceEl = g4ListEl.querySelector(`.g4-item[data-id="${g4SelectedSentenceId}"]`);
          sentenceEl.classList.add('matched');
          card.classList.add('used');
          g4Feedback.textContent = "Super! Dat passt.";
          g4Feedback.className = 'feedback ok';
          Array.from(g4ListEl.children).forEach(el=>el.classList.remove('selected'));
          g4SelectedSentenceId = null;

          const allMatched = g4Pairs.every(p=>{
            const s = g4ListEl.querySelector(`.g4-item[data-id="${p.id}"]`);
            return s && s.classList.contains('matched');
          });
          if(allMatched){
            g4Feedback.textContent = "Bravo! All Datumer si richteg gepaart.";
          }
        }else{
          g4Feedback.textContent = "Nee, deen Datum passt net zu deem Saz.";
          g4Feedback.className = 'feedback bad';
        }
      });
      g4CardsEl.appendChild(card);
    });
  }

  g4ResetBtn.addEventListener('click', g4Render);
  g4Render();

  /* ------------ GAME 5: Schreif den Datum ------------ */
  const g5Prompt = document.getElementById('g5Prompt');
  const g5Input = document.getElementById('g5Input');
  const g5Keyboard = document.getElementById('g5Keyboard');
  const g5CheckBtn = document.getElementById('g5CheckBtn');
  const g5NextBtn = document.getElementById('g5NextBtn');
  const g5Feedback = document.getElementById('g5Feedback');
  const g5Solution = document.getElementById('g5Solution');
  const g5Progress = document.getElementById('g5Progress');

  const g5Tasks = [
    {prompt:"02.07.", solution:"Den zweete Juli"},
    {prompt:"04.07.", solution:"De véierte Juli"},
    {prompt:"06.07.", solution:"De sechste Juli"},
    {prompt:"09.07.", solution:"Den néngte Juli"},
    {prompt:"11.07.", solution:"Den eeleften Juli"},
    {prompt:"12.07.", solution:"Den zwieleften Juli"},
    {prompt:"02.08.", solution:"Den zweeten August"},
    {prompt:"04.08.", solution:"De véierten August"},
    {prompt:"06.08.", solution:"De sechsten August"},
    {prompt:"10.08.", solution:"Den zéngten August"},
    {prompt:"02.10.", solution:"Den zweeten Oktober"},
    {prompt:"04.10.", solution:"De véierten Oktober"},
    {prompt:"06.10.", solution:"De sechsten Oktober"},
    {prompt:"18.10.", solution:"Den uechtzéngten Oktober"},
    {prompt:"09.12.", solution:"Den néngten Dezember"}
  ];

  let g5Order = shuffle([...Array(g5Tasks.length).keys()]);
  let g5Index = 0;

  function normalize(str){
    return str
      .toLowerCase()
      .replace(/\s+/g,' ')
      .trim();
  }

  function g5RenderTask(){
    const task = g5Tasks[g5Order[g5Index]];
    g5Prompt.textContent = `Schreiw: ${task.prompt}`;
    g5Input.value = '';
    g5Input.focus();
    g5Feedback.textContent='';
    g5Feedback.className='feedback';
    g5Solution.textContent='';
    g5Progress.textContent = `${g5Index+1} / ${g5Tasks.length}`;
  }

  g5CheckBtn.addEventListener('click', ()=>{
    const task = g5Tasks[g5Order[g5Index]];
    const user = normalize(g5Input.value);
    const correct = normalize(task.solution);
    if(!user){
      g5Feedback.textContent = "Schreiw fir d'éischt eppes.";
      g5Feedback.className = 'feedback bad';
      return;
    }
    if(user === correct){
      g5Feedback.textContent = "Super, dat ass genee esou geschriwwen!";
      g5Feedback.className = 'feedback ok';
      g5Solution.textContent = '';
    }else{
      g5Feedback.textContent = "Net ganz richteg.";
      g5Feedback.className = 'feedback bad';
      g5Solution.textContent = `Sou schreiwe mir et: ${task.solution}`;
    }
  });

  g5NextBtn.addEventListener('click', ()=>{
    g5Index++;
    if(g5Index >= g5Tasks.length){
      g5Order = shuffle([...Array(g5Tasks.length).keys()]);
      g5Index = 0;
    }
    g5RenderTask();
  });

  /* QWERTZ keyboard with SHIFT that visually uppercases */
  const keyboardRows = [
    ['q','w','e','r','t','z','u','i','o','p','ü','é'],
    ['a','s','d','f','g','h','j','k','l','ë','ä'],
    ['y','x','c','v','b','n','m'],
    ['SHIFT','SPACE','BACK']
  ];

  let shiftActive = false;

  function updateKeyboardLabels(){
    const keys = g5Keyboard.querySelectorAll('.g5-key');
    keys.forEach(btn=>{
      const key = btn.dataset.key;
      if(!key) return;
      if(key==='SPACE'){
        btn.textContent = '␣';
      }else if(key==='BACK'){
        btn.textContent = '⌫';
      }else if(key==='SHIFT'){
        btn.textContent = 'SHIFT';
        btn.classList.toggle('shift-active', shiftActive);
      }else{
        btn.textContent = shiftActive ? key.toUpperCase() : key.toLowerCase();
      }
    });
  }

  function addKey(text, wide=false){
    const btn = document.createElement('button');
    btn.className = 'g5-key' + (wide?' wide':'');
    btn.dataset.key = text;
    btn.textContent = text;
    btn.addEventListener('click', ()=>{
      if(text==='SPACE'){
        g5Input.value += ' ';
      }else if(text==='BACK'){
        g5Input.value = g5Input.value.slice(0,-1);
      }else if(text==='SHIFT'){
        shiftActive = !shiftActive;
        updateKeyboardLabels();
        return;
      }else{
        const ch = shiftActive ? text.toUpperCase() : text;
        g5Input.value += ch;
        if(shiftActive){
          shiftActive = false;
          updateKeyboardLabels();
        }
      }
      g5Input.focus();
    });
    return btn;
  }

  keyboardRows.forEach(row=>{
    const rowDiv = document.createElement('div');
    rowDiv.className='g5-row';
    row.forEach(key=>{
      const wide = (key==='SPACE'||key==='BACK'||key==='SHIFT');
      rowDiv.appendChild(addKey(key,wide));
    });
    g5Keyboard.appendChild(rowDiv);
  });
  updateKeyboardLabels();

  g5RenderTask();

  // start on game 1
  setGame(0);
</script>
</body>
</html>

