<!DOCTYPE html>
<html lang="lb">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>P4 – De Kalenner</title>

  <style>
    /* FONT */
    @font-face{
      font-family:'Schoulschrëft';
      src:url('https://raw.githubusercontent.com/albrechtclaire1007/schoulschreft/main/schoulschreft_bold%5B2%5D.TTF')
           format('truetype');
      font-weight:bold;
      font-style:normal;
      font-display:swap;
    }

    :root{
      --purple-mid:#b7a2e5;
      --purple-light:#ebe3ff;
      --purple-dark:#6c4aa3;
      --ink:#2d1844;
      --white:#fff;
      --ok:#b7f0c8;
      --bad:#ffcccc;
    }

    *{ margin:0; padding:0; box-sizing:border-box; }

    body{
      font-family:'Schoulschrëft', system-ui, sans-serif;
      background:var(--purple-light);
      padding:16px;
      color:var(--ink);
      min-height:100vh;
    }

    button{
      font-family:'Schoulschrëft', system-ui, sans-serif;
      cursor:pointer;
    }

    /* TOP BAR */
    .top-bar{
      max-width:1100px;
      margin:0 auto 8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      background:var(--purple-mid);
      border-radius:999px;
      padding:4px 10px;
      color:var(--white);
    }
    .top-bar-title{
      font-size:1.05rem;
      flex:1;
      text-align:center;
    }
    .top-arrow{
      width:28px;
      height:28px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:50%;
      border:2px solid var(--white);
      font-size:1.1rem;
      background:transparent;
      color:var(--white);
    }
    .top-arrow:disabled{
      opacity:0.4;
      cursor:default;
    }

    .subtitle{
      max-width:1100px;
      margin:0 auto 12px;
      text-align:center;
      font-size:0.9rem;
      opacity:0.8;
    }

    .games{
      max-width:1100px;
      margin:0 auto;
    }

    .game{ display:none; }
    .game.active{ display:block; }

    h2{
      font-size:1.1rem;
      margin-bottom:4px;
      text-align:center;
      color:var(--purple-dark);
    }
    .instructions{
      text-align:center;
      font-size:0.9rem;
      opacity:0.8;
      margin-bottom:10px;
    }

    .primary{
      padding:6px 14px;
      border-radius:999px;
      border:2px solid var(--purple-dark);
      background:var(--purple-mid);
      color:var(--white);
      font-size:0.9rem;
    }
    .secondary{
      padding:4px 10px;
      border-radius:999px;
      border:2px solid var(--purple-mid);
      background:white;
      color:var(--ink);
      font-size:0.85rem;
    }

    .feedback{
      margin-top:6px;
      min-height:1.4em;
      font-size:0.9rem;
    }
    .feedback.ok{ color:#117a3a; }
    .feedback.bad{ color:#b02323; }

    /* GAME 1 */
    .g1-layout{
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:center;
    }
    @media(min-width:780px){
      .g1-layout{
        flex-direction:row;
        align-items:flex-start;
        justify-content:center;
      }
    }
    .g1-left{
      flex:0 0 250px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .audio-btn{
      width:56px;
      height:56px;
      border-radius:50%;
      border:3px solid var(--purple-dark);
      background:var(--purple-mid);
      display:flex;
      align-items:center;
      justify-content:center;
      margin-bottom:6px;
    }
    .audio-btn span{
      width:0;
      height:0;
      border-top:10px solid transparent;
      border-bottom:10px solid transparent;
      border-left:16px solid #fff;
      margin-left:2px;
    }

    .g1-calendar{
      width:100%;
      max-width:600px;
      background:white;
      box-shadow:0 6px 16px rgba(0,0,0,0.1);
      padding:10px 14px 14px;
      border-radius:24px;
    }
    .g1-weekdays{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      text-align:center;
      opacity:0.8;
      margin-bottom:4px;
    }

    .g1-cal-grid{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:3px;
    }
    .g1-day{
      height:48px;
      border-radius:12px;
      border:2px solid #e0d6ff;
      background:#fdfbff;
      font-size:0.9rem;
      display:flex;
      align-items:flex-start;
      justify-content:flex-end;
      padding:3px 5px;
    }
    .g1-day.correct{
      background:var(--ok);
      border-color:#117a3a;
    }
    .g1-day.wrong{
      background:var(--bad);
      border-color:#b02323;
    }

    /* GAME 2 */
    .g2-wrapper{
      max-width:600px;
      margin:0 auto;
    }
    .g2-question{
      text-align:center;
      margin-bottom:6px;
    }
    .g2-options{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(110px,1fr));
      gap:6px;
    }
    .g2-options button{
      padding:6px;
      border-radius:12px;
      border:2px solid var(--purple-mid);
      background:white;
    }
    .g2-options .correct{
      background:var(--ok);
      border-color:#117a3a;
    }
    .g2-options .wrong{
      background:var(--bad);
      border-color:#b02323;
    }

    /* GAME 3 */
    .g3-display{
      display:flex;
      flex-direction:column;
      align-items:center;
      margin-top:10px;
      gap:10px;
    }

    .g3-big{
      padding:8px 14px;
      border-radius:999px;
      background:white;
      border:2px solid var(--purple-mid);
      font-size:1.6rem;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }

    .wheels{
      display:flex;
      gap:3px;
      padding:10px 14px;
      border-radius:18px;
      background:white;
      border:2px solid var(--purple-mid);
      font-size:1.4rem;
    }
    .wheel{
      width:26px;
      height:40px;
      border-radius:10px;
      border:2px solid var(--purple-mid);
      background:#f9f5ff;
      position:relative;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .wheel span{
      position:absolute;
    }

    /* GAME 4 */
    .g4-layout{
      display:grid;
      grid-template-columns:1.1fr 0.9fr;
      gap:12px;
    }
    @media(max-width:900px){
      .g4-layout{ grid-template-columns:1fr; }
    }
    .g4-box{
      background:rgba(183,162,229,0.15);
      padding:8px;
      border-radius:18px;
      box-shadow:0 5px 12px rgba(0,0,0,0.1);
    }
    .g4-list{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
      gap:4px;
    }
    .g4-item{
      padding:5px 7px;
      background:white;
      border-radius:12px;
      border:2px solid var(--purple-mid);
      font-size:0.9rem;
    }
    .g4-item.selected{
      border-color:var(--purple-dark);
    }
    .g4-item.matched{
      background:var(--ok);
      border-color:#117a3a;
    }

    .g4-cards{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      justify-content:center;
    }
    .g4-card{
      padding:5px 9px;
      border-radius:999px;
      border:2px solid var(--purple-mid);
      background:white;
    }
    .g4-card.used{
      opacity:0.4;
      cursor:default;
    }

    /* GAME 5 */
    .g5-wrapper{
      max-width:800px;
      margin:0 auto;
    }
    .g5-prompt{ font-size:1rem; margin-bottom:6px; }
    .g5-input-row input{
      width:100%;
      padding:6px 8px;
      border-radius:999px;
      border:2px solid var(--purple-mid);
      font-size:0.95rem;
    }

    .g5-keyboard{
      display:flex;
      flex-direction:column;
      gap:3px;
      margin:6px 0;
    }
    .g5-row{
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      gap:3px;
    }
    .g5-key{
      min-width:26px;
      padding:4px 6px;
      border-radius:8px;
      background:white;
      border:1px solid var(--purple-mid);
      font-size:0.8rem;
    }
    .g5-key.wide{ min-width:50px; }
    .g5-key.shift-active{
      background:var(--purple-mid);
      color:white;
    }

    .solution{ font-size:0.85rem; opacity:0.85; }
    .progress{ font-size:0.8rem; opacity:0.8; }
  </style>
</head>

<body>

  <!-- TOP BAR -->
  <div class="top-bar">
    <button id="topPrev" class="top-arrow">‹</button>
    <div id="topTitle" class="top-bar-title">1. Lauschter a klick</div>
    <button id="topNext" class="top-arrow">›</button>
  </div>
  <p class="subtitle">P4 – De Kalenner: Datumer liesen a schreiwen</p>

  <div class="games">

    <!-- GAME 1 -->
    <section id="game1" class="game active">
      <h2>1. Lauschter a klick</h2>
      <p class="instructions">Lauschter den Datum a klick duerno op déi richteg Zuel um Kalenner.</p>

      <div class="g1-layout">
        <div class="g1-left">
          <button id="g1PlayBtn" class="audio-btn">
            <span></span>
          </button>
          <p class="audio-label">Klick fir ze lauschteren.</p>
          <button id="g1NextBtn" class="secondary">Nächsten Datum</button>
          <div id="g1Feedback" class="feedback"></div>
        </div>

        <div class="g1-calendar">
          <div class="g1-weekdays">
            <div>Mo</div><div>Di</div><div>Më</div><div>Do</div><div>Fr</div><div>Sa</div><div>So</div>
          </div>
          <div id="g1CalGrid" class="g1-cal-grid"></div>
        </div>
      </div>
    </section>

    <!-- GAME 2 -->
    <section id="game2" class="game">
      <h2>2. Lies a klick</h2>
      <p class="instructions">Lies den Datum a klick op déi richteg Zueleschreifweis.</p>
      <div class="g2-wrapper">
        <div id="g2Question" class="g2-question"></div>
        <div id="g2Options" class="g2-options"></div>
        <button id="g2CheckWritten" class="secondary" style="margin-top:6px;">
          Weis mer de geschriwwenen Datum
        </button>
        <div style="text-align:center;margin-top:6px;">
          <button id="g2NextBtn" class="secondary">Nächst Fro</button>
        </div>
        <div id="g2Feedback" class="feedback"></div>
      </div>
    </section>

    <!-- GAME 3 -->
    <section id="game3" class="game">
      <h2>3. Lies den Datum</h2>
      <p class="instructions">Kuck op d'Zuelen a lies de ganzen Datum vir.</p>

      <div class="g3-display">
        <div id="g3Big" class="g3-big"></div>

        <div class="wheels" id="g3Wheels">
          <div class="wheel"><span>0</span></div>
          <div class="wheel"><span>1</span></div>
          <div class="dot">.</div>
          <div class="wheel"><span>0</span></div>
          <div class="wheel"><span>1</span></div>
          <div class="dot">.</div>
          <div class="wheel"><span>2</span></div>
          <div class="wheel"><span>0</span></div>
          <div class="wheel"><span>2</span></div>
          <div class="wheel"><span>4</span></div>
        </div>

        <div style="display:flex;gap:8px;">
          <button id="g3PrevBtn" class="secondary">◀️ Zréck</button>
          <button id="g3NextBtn" class="primary">▶️ Nächst</button>
        </div>
      </div>
    </section>

    <!-- GAME 4 -->
    <section id="game4" class="game">
      <h2>4. Fann de passenden Datum</h2>
      <p class="instructions">Wielt e Saz a klick duerno op déi passend Zueleschreifweis.</p>

      <div class="g4-layout">
        <div class="g4-box">
          <h3>Datumer am Saz</h3>
          <div id="g4List" class="g4-list"></div>
        </div>

        <div class="g4-box">
          <h3>Zueleschreifweis</h3>
          <div id="g4Cards" class="g4-cards"></div>
        </div>
      </div>

      <div style="text-align:center;margin-top:8px;">
        <button id="g4ResetBtn" class="secondary">Nach eng Kéier</button>
      </div>

      <div id="g4Feedback" class="feedback"></div>
    </section>

    <!-- GAME 5 -->
    <section id="game5" class="game">
      <h2>5. Schreif den Datum</h2>

      <div class="g5-wrapper">
        <div id="g5Prompt" class="g5-prompt"></div>

        <div class="g5-input-row">
          <input id="g5Input" placeholder="Den éischten Januar ..." autocomplete="off"/>
        </div>

        <div id="g5Keyboard" class="g5-keyboard"></div>

        <div style="display:flex;gap:8px;margin-bottom:6px;">
          <button id="g5CheckBtn" class="primary">Kontrolléier</button>
          <button id="g5NextBtn" class="secondary">Nächst</button>
        </div>

        <div id="g5Feedback" class="feedback"></div>
        <div id="g5Solution" class="solution"></div>
        <div id="g5Progress" class="progress"></div>
      </div>
    </section>

  </div>

<script>
/* ----------------------------------------------------------  
   HELPERS  
-----------------------------------------------------------*/

function shuffle(a){
  return a.map(v=>({v,sort:Math.random()}))
          .sort((a,b)=>a.sort-b.sort)
          .map(o=>o.v);
}

function pad(n,len){ return n.toString().padStart(len,'0'); }

/* ----------------------------------------------------------  
   ORDINAL + GRAMMAR ENGINE  
-----------------------------------------------------------*/

const MONTHS = [
  "Januar","Februar","Mäerz","Abrëll","Mee","Juni",
  "Juli","August","September","Oktober","November","Dezember"
];

const ORDINAL = {
  1: "den éischten",
  2: "den zweeten",
  3: "den drëtten",
  4: "de véierten",
  5: "de fënneften",
  6: "de sechsten",
  7: "de siwenten",
  8: "den aachten",
  9: "den néngten",
  10:"den zéngten",
  11:"den eeleften",
  12:"den zwieleften",
  13:"den dräizéngten",
  14:"de véierzéngten",
  15:"de fofzéngten",
  16:"de siechzéngten",
  17:"de siwwenzéngten",
  18:"den uechtzéngten",
  19:"den nonzéngten",
  20:"den zwanzegsten",
  21:"den eenanzwanzegsten",
  22:"den zweeanzwanzegsten",
  23:"den dräianzwanzegsten",
  24:"den véieranzwanzegsten",
  25:"den fënnefanzwanzegsten",
  26:"den sechsanzwanzegsten",
  27:"den siwenanzwanzegsten",
  28:"den aachtanzwanzegsten",
  29:"den nénganzwanzegsten",
  30:"den drëssegsten",
  31:"den eenendrëssegsten"
};

const N_RULE = ["u","n","i","t","e","d","z","o","a","h","é"];

function applyMonthNRule(ordinal, monthName){
  const first = monthName.trim().toLowerCase()[0];
  const needsN = N_RULE.includes(first);
  if(needsN){
    if(!ordinal.endsWith("n")) return ordinal+"n";
    return ordinal;
  } else {
    if(ordinal.endsWith("n"))
      return ordinal.replace(/n$/, "");
    return ordinal;
  }
}

function fullWritten(day, mIdx){
  let base = ORDINAL[day];
  let adj = applyMonthNRule(base, MONTHS[mIdx]);
  return `${adj} ${MONTHS[mIdx]}`;
}

/* ----------------------------------------------------------  
   NAV  
-----------------------------------------------------------*/

const games = document.querySelectorAll('.game');
const topTitle=document.getElementById('topTitle');
const topPrev=document.getElementById('topPrev');
const topNext=document.getElementById('topNext');

const gameTitles=[
  '1. Lauschter a klick',
  '2. Lies a klick',
  '3. Lies den Datum',
  '4. Fann de passenden Datum',
  '5. Schreif den Datum'
];

let currentGame=0;

function setGame(i){
  currentGame=i;
  games.forEach(g=>g.classList.remove('active'));
  games[i].classList.add('active');
  topTitle.textContent=gameTitles[i];
  topPrev.disabled=(i===0);
  topNext.disabled=(i===4);
}

topPrev.onclick=()=>{ if(currentGame>0)setGame(currentGame-1); };
topNext.onclick=()=>{ if(currentGame<4)setGame(currentGame+1); };

/* ----------------------------------------------------------  
   GAME 1  
-----------------------------------------------------------*/

const AUDIO_BASE = "https://github.com/albrechtclaire1007/p4kalenner/raw/refs/heads/main/";
const g1Audio=new Audio();
const g1Play=document.getElementById('g1PlayBtn');
const g1Next=document.getElementById('g1NextBtn');
const g1Feedback=document.getElementById('g1Feedback');
const g1CalGrid=document.getElementById('g1CalGrid');
let g1Days=[];
let g1Current=null;
let g1Locked=false;

for(let d=1;d<=31;d++){
  const b=document.createElement('button');
  b.className='g1-day';
  b.textContent=d;
  b.dataset.day=d;
  g1CalGrid.appendChild(b);
  g1Days.push(b);
}

function g1New(){
  g1Locked=false;
  g1Feedback.textContent="";
  g1Days.forEach(b=>b.classList.remove('correct','wrong'));

  g1Current=Math.floor(Math.random()*31)+1;
  g1Audio.src=AUDIO_BASE+`P4__${g1Current}..mp3`;
  g1Audio.play().catch(()=>{});
}
g1Play.onclick=()=>{ g1Audio.currentTime=0; g1Audio.play(); };
g1Next.onclick=g1New;

g1Days.forEach(b=>{
  b.onclick=()=>{
    if(g1Locked)return;
    const pick=+b.dataset.day;
    if(pick===g1Current){
      b.classList.add('correct');
      g1Feedback.textContent=`Super!`;
      g1Locked=true;
    } else {
      b.classList.add('wrong');
      setTimeout(()=>b.classList.remove('wrong'),200);
      g1Feedback.textContent="Nee.";
    }
  };
});

g1New();

/* ----------------------------------------------------------  
   GAME 2  
-----------------------------------------------------------*/

const g2Question=document.getElementById('g2Question');
const g2Options=document.getElementById('g2Options');
const g2Feedback=document.getElementById('g2Feedback');
const g2CheckW=document.getElementById('g2CheckWritten');
const g2Next=document.getElementById('g2NextBtn');

let g2Tasks=[];
for(let i=0;i<25;i++){
  const d=Math.floor(Math.random()*31)+1;
  const m=Math.floor(Math.random()*12);
  const spelled=fullWritten(d,m);
  const correct=`${pad(d,2)}.${pad(m+1,2)}.`;

  const others=[];
  while(others.length<4){
    const d2=Math.floor(Math.random()*31)+1;
    const m2=Math.floor(Math.random()*12);
    const num=`${pad(d2,2)}.${pad(m2+1,2)}.`;
    if(num!==correct && !others.includes(num)) others.push(num);
  }
  g2Tasks.push({day:d,month:m,spelled,correct,others});
}

let g2Order=shuffle([...Array(g2Tasks.length).keys()]);
let g2Index=0;
let g2Current=null;

function g2Render(){
  g2Feedback.textContent="";
  g2Options.innerHTML="";

  const idx=g2Order[g2Index];
  g2Current=g2Tasks[idx];

  g2Question.textContent=g2Current.spelled;

  const all=[g2Current.correct, ...g2Current.others];
  shuffle(all).forEach(opt=>{
    const b=document.createElement('button');
    b.textContent=opt;
    b.onclick=()=>{
      [...g2Options.children].forEach(x=>x.disabled=true);
      if(opt===g2Current.correct){
        b.classList.add('correct');
        g2Feedback.textContent="Super!";
        g2Feedback.className='feedback ok';
      } else {
        b.classList.add('wrong');
        g2Feedback.textContent=`Nee. Richteg: ${g2Current.correct}`;
        g2Feedback.className='feedback bad';
        [...g2Options.children].forEach(x=>{
          if(x.textContent===g2Current.correct)x.classList.add('correct');
        });
      }
    };
    g2Options.appendChild(b);
  });

  g2CheckW.onclick = ()=>{
    g2Feedback.textContent = fullWritten(g2Current.day,g2Current.month);
    g2Feedback.className = 'feedback ok';
  };
}

g2Next.onclick=()=>{
  g2Index++;
  if(g2Index>=g2Order.length){
    g2Order=shuffle([...Array(g2Tasks.length).keys()]);
    g2Index=0;
  }
  g2Render();
};

g2Render();

/* ----------------------------------------------------------  
   GAME 3  
-----------------------------------------------------------*/

const g3Big=document.getElementById('g3Big');
const g3Wheels=document.querySelectorAll('#g3Wheels .wheel');
const g3Prev=document.getElementById('g3PrevBtn');
const g3Next=document.getElementById('g3NextBtn');

function daysInMonth(m,y){ return new Date(y,m,0).getDate(); }

let g3Hist=[];
let g3Ptr=-1;

function randomDate(){
  const y=2000+Math.floor(Math.random()*30);
  const m=1+Math.floor(Math.random()*12);
  const d=1+Math.floor(Math.random()*daysInMonth(m,y));
  return {d,m,y};
}

function digitsOf(obj){
  return `${pad(obj.d,2)}${pad(obj.m,2)}${obj.y}`.split("");
}

function animateWheel(w,digit){
  const s=w.querySelector('span');
  s.style.animation='none';
  s.offsetHeight;
  s.textContent=digit;
  s.style.animation='wheelSpin .25s ease-out';
}

function showG3(obj,push=true){
  const dig=digitsOf(obj);
  g3Wheels.forEach((w,i)=>animateWheel(w,dig[i]));
  g3Big.textContent = `${pad(obj.d,2)}.${pad(obj.m,2)}.${obj.y}`;

  if(push){
    g3Hist.splice(g3Ptr+1);
    g3Hist.push(obj);
    g3Ptr=g3Hist.length-1;
  }
  g3Prev.disabled=(g3Ptr<=0);
}

g3Next.onclick=()=>showG3(randomDate(),true);
g3Prev.onclick=()=>{
  if(g3Ptr>0){
    g3Ptr--;
    showG3(g3Hist[g3Ptr],false);
  }
};

showG3(randomDate(),true);

/* ----------------------------------------------------------  
   GAME 4  
-----------------------------------------------------------*/

const g4List=document.getElementById('g4List');
const g4Cards=document.getElementById('g4Cards');
const g4Feedback=document.getElementById('g4Feedback');
const g4Reset=document.getElementById('g4ResetBtn');

let g4Pairs=[];
for(let i=0;i<20;i++){
  const d=Math.floor(Math.random()*31)+1;
  const m=Math.floor(Math.random()*12);
  g4Pairs.push({
    id:i+1,
    text:fullWritten(d,m),
    num:`${pad(d,2)}.${pad(m+1,2)}.`
  });
}

function g4Render(){
  g4Feedback.textContent="";
  g4List.innerHTML="";
  g4Cards.innerHTML="";
  let selected=null;

  const order=shuffle([...g4Pairs]);
  order.forEach(p=>{
    const item=document.createElement('div');
    item.className='g4-item';
    item.dataset.id=p.id;
    item.textContent=p.text;
    item.onclick=()=>{
      [...g4List.children].forEach(x=>x.classList.remove('selected'));
      if(!item.classList.contains('matched')){
        item.classList.add('selected');
        selected=p.id;
      }
    };
    g4List.appendChild(item);
  });

  const cards=shuffle([...g4Pairs]);
  cards.forEach(p=>{
    const c=document.createElement('div');
    c.className='g4-card';
    c.dataset.id=p.id;
    c.textContent=p.num;
    c.onclick=()=>{
      if(c.classList.contains('used'))return;
      if(!selected){
        g4Feedback.textContent="Wielt fir d'éischt e Saz.";
        g4Feedback.className='feedback bad';
        return;
      }
      if(selected==p.id){
        c.classList.add('used');
        const match=g4List.querySelector(`[data-id="${p.id}"]`);
        match.classList.add('matched');
        g4Feedback.textContent="Super!";
        g4Feedback.className='feedback ok';
        selected=null;
      } else {
        g4Feedback.textContent="Nee.";
        g4Feedback.className='feedback bad';
      }
    };
    g4Cards.appendChild(c);
  });
}
g4Reset.onclick=g4Render;
g4Render();

/* ----------------------------------------------------------  
   GAME 5  
-----------------------------------------------------------*/

const g5Prompt=document.getElementById('g5Prompt');
const g5Input=document.getElementById('g5Input');
const g5Keyboard=document.getElementById('g5Keyboard');
const g5Check=document.getElementById('g5CheckBtn');
const g5Next=document.getElementById('g5NextBtn');
const g5Feedback=document.getElementById('g5Feedback');
const g5Solution=document.getElementById('g5Solution');
const g5Progress=document.getElementById('g5Progress');

let g5Tasks=[];
for(let i=0;i<20;i++){
  const d=Math.floor(Math.random()*31)+1;
  const m=Math.floor(Math.random()*12);
  g5Tasks.push({
    prompt:`${pad(d,2)}.${pad(m+1,2)}.`,
    solution:fullWritten(d,m)
  });
}

let g5Order=shuffle([...Array(g5Tasks.length).keys()]);
let g5Index=0;

function norm(s){
  return s.toLowerCase().trim().replace(/\s+/g,' ');
}

function g5Render(){
  const t=g5Tasks[g5Order[g5Index]];
  g5Prompt.textContent=`Schreiw: ${t.prompt}`;
  g5Input.value="";
  g5Feedback.textContent="";
  g5Solution.textContent="";
  g5Progress.textContent=`${g5Index+1} / ${g5Tasks.length}`;
  g5Input.focus();
}

g5Check.onclick=()=>{
  const t=g5Tasks[g5Order[g5Index]];
  const user=norm(g5Input.value);
  const corr=norm(t.solution);
  if(!user){
    g5Feedback.textContent="Schreiw eppes.";
    g5Feedback.className='feedback bad';
    return;
  }
  if(user===corr){
    g5Feedback.textContent="Super!";
    g5Feedback.className='feedback ok';
  } else {
    g5Feedback.textContent="Net ganz richteg.";
    g5Feedback.className='feedback bad';
    g5Solution.textContent=`Sou schreiwe mir et: ${t.solution}`;
  }
};

g5Next.onclick=()=>{
  g5Index++;
  if(g5Index>=g5Order.length){
    g5Order=shuffle([...Array(g5Tasks.length).keys()]);
    g5Index=0;
  }
  g5Render();
};

/* Keyboard */
const rows=[
  ['q','w','e','r','t','z','u','i','o','p','ü','é'],
  ['a','s','d','f','g','h','j','k','l','ë','ä'],
  ['y','x','c','v','b','n','m'],
  ['SHIFT','SPACE','BACK']
];

let shift=false;

function updateKeys(){
  document.querySelectorAll('.g5-key').forEach(btn=>{
    const key=btn.dataset.key;
    if(key==='SHIFT'){
      btn.classList.toggle('shift-active',shift);
      btn.textContent='SHIFT';
    } else if(key==='SPACE'){
      btn.textContent='␣';
    } else if(key==='BACK'){
      btn.textContent='⌫';
    } else {
      btn.textContent = shift ? key.toUpperCase() : key.toLowerCase();
    }
  });
}

function addKey(k,wide=false){
  const b=document.createElement('button');
  b.className='g5-key'+(wide?' wide':'');
  b.dataset.key=k;
  b.onclick=()=>{
    if(k==='SHIFT'){ shift=!shift; updateKeys(); return; }
    if(k==='SPACE'){ g5Input.value+=' '; return; }
    if(k==='BACK'){ g5Input.value=g5Input.value.slice(0,-1); return; }
    const letter = shift ? k.toUpperCase() : k.toLowerCase();
    g5Input.value += letter;
    if(shift){ shift=false; updateKeys(); }
    g5Input.focus();
  };
  return b;
}

rows.forEach(row=>{
  const div=document.createElement('div');
  div.className='g5-row';
  row.forEach(k=>{
    const wide=(k==='SPACE'||k==='BACK'||k==='SHIFT');
    div.appendChild(addKey(k,wide));
  });
  g5Keyboard.appendChild(div);
});

updateKeys();
g5Render();

/* Start */
setGame(0);

</script>

</body>
</html>

